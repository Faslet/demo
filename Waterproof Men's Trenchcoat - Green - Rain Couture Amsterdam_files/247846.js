/*  */(function(){'use strict';var TranslatedMessages={'CHANGE_SERVICE_POINT':{'de-de':'Paketshop ändern','en-us':'Change Service Point','en-gb':'Change Service Point','es-es':'Cambiar Punto de Servicio','fr-fr':'Changer de Point Service','it-it':'Cambia Service Point','nl-nl':'Verander afhaalpunt',},'CONFIRM_SERVICE_POINT':{'de-de':'Paketshop bestätigen','en-us':'Confirm Service Point','en-gb':'Confirm Service Point','es-es':'Confirmar Punto de Servicio','fr-fr':'Valider le Point Service','it-it':'Conferma Service Point','nl-nl':'Bevestig afhaalpunt',},'NO_SERVICE_POINT_SELECTED':{'de-de':'Kein Paketshop ausgewählt.','en-us':'No service point selected.','en-gb':'No service point selected.','es-es':'No se ha seleccionado ningún punto de servicio.','fr-fr':'Aucun Point Service sélectionné','it-it':'Nessun Service Point selezionato.','nl-nl':'Geen afhaalpunt geselecteerd',},'SELECT_SERVICE_POINT':{'de-de':'Wählen Sie einen Paketshop','en-us':'Select Service Point','en-gb':'Select Service Point','es-es':'Seleccionar un Punto de Servicio','fr-fr':'Sélectionner un Point Service','it-it':'Seleziona Service Point','nl-nl':'Selecteer Afhaalpunt',},'SELECTED_SERVICE_POINT':{'de-de':'Der folgende Paketshop wurde ausgewählt:','en-us':'The following service point was selected:','en-gb':'The following service point was selected:','es-es':'Se seleccionó el siguiente punto de servicio:','fr-fr':'Le Point Service suivant a été sélectionné :','it-it':'È stato selezionato il seguente Service Point:','nl-nl':'Je hebt het volgende afhaalpunt geselecteerd:',},'SELECTED_SHIPPING_METHOD':{'de-de':'Sie haben Paketshopzustellung als Versandmethode ausgewählt. Bitte wählen Sie jetzt den Paketshop aus.','en-us':'You have selected the service point delivery as shipping method, please select now the service point','en-gb':'You have selected the service point delivery as shipping method, please select now the service point','es-es':'Has seleccionado la entrega en el punto de servicio como método de envío, por favor selecciona ahora el punto de servicio','fr-fr':'Vous avez choisi la livraison en Point Service comme méthode de livraison, veuillez sélectionner maintenant un Point Service','it-it':'Hai selezionato la consegna al Service Point come metodo di spedizione. Ora seleziona il Service Point','nl-nl':'Je hebt afhaalpunt levering gekozen. Je kunt nu het gewenste afhaalpunt kiezen.',},'SERVICE_POINT_DETAILS':{'de-de':'Paketshop Details','en-us':'Service point details','en-gb':'Service point details','es-es':'Detalles del Punto de Servicio','fr-fr':'Détails du Point Service','it-it':'Dettagli Service Point','nl-nl':'Informatie geselecteerd afhaalpunt',},'SERVICE_POINT_ERROR':{'de-de':'Bitte wählen Sie einen Paketshop aus','en-us':'Please select one Service Point','en-gb':'Please select one Service Point','es-es':'Por favor, elige un Punto de Servicio','fr-fr':'Veuillez sélectionner un Point Service','it-it':'Selezionare un Service Point','nl-nl':'Selecteer een afhaalpunt a.u.b.',},'UPDATE_BROWSER':{'de-de':'Sie verwenden einen veralteten Browser. Aktualisieren Sie bitte Ihren Browser, um einen Paketshop auszuwählen.','en-us':'You are using an outdated browser. Please upgrade your browser to select a service point location.','en-gb':'You are using an outdated browser. Please upgrade your browser to select a service point location.','es-es':'Estás utilizando un navegador obsoleto. Actualiza tu navegador para seleccionar una ubicación de punto de servicio.','fr-fr':'Vous utilisez un navigateur obsolète. Veuillez mettre à jour votre navigateur pour sélectionner une zone de Point Service.','it-it':'Stai utilizzando un browser obsoleto. Aggiorna il tuo browser per selezionare la posizione di un Service Point.','nl-nl':'Je browser is niet meer up-to-date. Update je internet browser om een afhaalpunt locatie te kunnen kiezen. ',},};var BASE_DOMAIN='https://servicepoints.sendcloud.sc';var shippingMethodsNames=new RegExp('(service point delivery|servicepunt levering|paketshop zustellung|paketshopzustellung|livraison en point relais|livraison point relais|service point relais|recogida en punto de servicio|punto de servicio|consegna al punto di servizio|consegna al punto di ritiro|consegna al pick up point|consegna al punto di raccolta|punto di servizio|punto di ritiro|punto di raccolta|pick up point|service points|postpunt|afhaalpunt|servicepunt|servicepoint|service-point|service point|ophalen bij postnl locatie|pickup location - dhl\/postnl pickup location)');function loadScript(url,callback){var script=document.createElement('script');script.type='text/javascript';if(script.readyState){script.onreadystatechange=function(){if(script.readyState==='loaded'||script.readyState==='complete'){script.onreadystatechange=null;callback();}};}else{script.onload=callback;}
script.src=url;document.getElementsByTagName('head')[0].appendChild(script);}
function main($){var urlPath=window.location.pathname;var shipmentUrl=/\/.*checkout\/.*(shipment|onepage|onestep)\//;function getXHR(){var xhr=$.ajaxSettings.xhr();var setRequestHeader=xhr.setRequestHeader;xhr.setRequestHeader=function(name,value){if(name==='X-Requested-With'){return;}
setRequestHeader.call(this,name,value);};return xhr;}
function getSEOshopInfo(){var url=window.location.pathname+'?format=json';return $.ajax({url:url,xhr:getXHR});}
if(urlPath.match(shipmentUrl)){getSEOshopInfo().then(selectShippingMethod);}
function selectMessageLanguage(message,language){var messageLanguage='en-us';if(language in message){messageLanguage=language;}
return message[messageLanguage];}
function selectShippingMethod(seoshopData){var quoteId=seoshopData.page.cart.quote_id;var language=seoshopData.shop.language;var $iframeDiv=null;var $loading=null;$('#gui-form').attr('onsubmit','return processForm();');$('div.gui-section[data-name=shipment]').on('DOMSubtreeModified',lookForShippingMethod);window.addEventListener('message',servicePointSelectedMessage,false);window.addEventListener('message',servicePointCloseMessage,false);window.processForm=processForm;lookForShippingMethod();function lookForShippingMethod(){$('input[name=shipment_method]').parents('.gui-block-option').each(addButtonDiv);}
function addButtonDiv(){var $this=$(this);var $input=$this.find('input');var shipmethodLabel=$this.find('label').first().text().toLowerCase();setTimeout(function(){if($('#sendcloud-spp').length===0&&shipmethodLabel.match(shippingMethodsNames)){var selectedServicePoint=sessionStorage.getItem('service_point_name_'+quoteId)||selectMessageLanguage(TranslatedMessages.NO_SERVICE_POINT_SELECTED,language);var buttonText=sessionStorage.getItem('service_point_name_'+quoteId)?selectMessageLanguage(TranslatedMessages.CHANGE_SERVICE_POINT,language):selectMessageLanguage(TranslatedMessages.SELECT_SERVICE_POINT,language);var $button=$('<a id="spsb" class="gui-button-small gui-button-action">'+buttonText+'</a>');var $servicePointText=$('<p id="sendcloud-spp-selected">'+selectedServicePoint+'</p>');var $content=$('<div class="gui-field-content">');var $buttonDiv=$('<div id="sendcloud-spp">').append('<div class="gui-spacer"></div>',$('<p>').append($button),$servicePointText);$input.data('sc-service-point',true);$button.click(showPointPicker);$button.css({cursor:'pointer'});$this.find('div.gui-field').append($content.append($buttonDiv));}
function showPointPicker(){$input.click();getSEOshopInfo().then(openPointPicker);}},1);}
function openPointPicker(seoshopData){var msie=document.documentMode;if(msie&&msie<=9){alert(selectMessageLanguage(TranslatedMessages.UPDATE_BROWSER,language));return;}
var shipping=seoshopData.checkout.shipping_address||seoshopData.checkout.progress.shipping;function getValueFromDOM(selectors){for(var i=0;i<selectors.length;i++){var el=document.querySelector(selectors[i]);if(el&&el.value){return el.value;}}
return null;}
function getPostalCode(){var selectors=['input[name="shipping_address[zipcode]"]','input[name="billing_address[zipcode]"]'];return getValueFromDOM(selectors)||shipping.zipcode;}
function getCountryCode(){var selectors=['input[name="shipping_address[country]"]','input[name="billing_address[country]"]'];return getValueFromDOM(selectors)||shipping.country.code||shipping.country;}
var params={'api-key':'eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJleHAiOjE2MTE4NTcwMTIsImlpZCI6Mjk5MjR9.vACZYfUZi-0XR3TmYoWD73v3NfmiZHazbZ6wno5Fx98',country:getCountryCode(),'postal-code':getPostalCode(),language:language,'close-button':1,'store-order-id':'quote_id:'+quoteId};var selectedServicePointId=sessionStorage.getItem('service_point_id_'+quoteId);if(selectedServicePointId!==undefined){params.id=selectedServicePointId;}
if(seoshopData.page&&seoshopData.page.cart&&seoshopData.page.cart.products){var dimensions=[];var products=seoshopData.page.cart.products;for(var i=0;i<products.length;i++){dimensions.push([products[i].size.x||0,products[i].size.y||0,products[i].size.z||0]);}
params['dimensions-unit']='cm';params.dimensions=btoa(JSON.stringify(dimensions));}
var url=BASE_DOMAIN+'/embed/v3/service-point-picker/?'+$.param(params);var $iframe=$('<iframe src="'+url+'" width="100%" height="100%">');var $body=$('body');$iframeDiv=$('<div>');$loading=$('<div>');$loading.css({position:'fixed',top:'0',left:'0',right:'0',bottom:'0','z-index':2147483646,'background-color':'black',opacity:0.7});$iframeDiv.css({position:'fixed',top:'0',left:'0',right:'0',bottom:'0','z-index':2147483647});$body.append($iframeDiv.append($iframe));$body.append($loading);}
function removeServicePointPicker(){$iframeDiv.remove();$loading.remove();}
function servicePointSelectedMessage(event){if(event.origin!==BASE_DOMAIN||event.data.type!=='servicePointSelected'){return;}
var point=event.data.point;sessionStorage.setItem('service_point_id_'+quoteId,point.id);sessionStorage.setItem('service_point_name_'+quoteId,point.name);removeServicePointPicker();var $servicePointText=$('#sendcloud-spp-selected');$servicePointText.text(point.name);$servicePointText.css({color:''});var $servicePointButton=$('#spsb');$servicePointButton.text(sessionStorage.getItem('service_point_name_'+quoteId)?selectMessageLanguage(TranslatedMessages.CHANGE_SERVICE_POINT,language):selectMessageLanguage(TranslatedMessages.SELECT_SERVICE_POINT,language));}
function servicePointCloseMessage(event){if(event.origin!==BASE_DOMAIN||event.data.type!=='servicePointClose'){return;}
removeServicePointPicker();}
function processForm(){var shipmethodLabel=$('input[name=shipment_method]:checked').parents('.gui-block-option').find('label').first().text().toLowerCase();var servicePointId=sessionStorage.getItem('service_point_id_'+quoteId);if(shipmethodLabel.match(shippingMethodsNames)){if(!servicePointId){var $servicePointText=$('#sendcloud-spp-selected');$servicePointText.text(selectMessageLanguage(TranslatedMessages.SERVICE_POINT_ERROR,language));$servicePointText.css({color:'red'});return false;}}else{deselectServicePoint(quoteId);}
return true;}}
function deselectServicePoint(quoteId){sessionStorage.removeItem('service_point_id_'+quoteId);sessionStorage.removeItem('service_point_name_'+quoteId);}}
function bootstrap($){$(document).ready(function(){main($);});}
if(typeof jQuery==='undefined'){loadScript('//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js',function(){var jQuery191=jQuery.noConflict(true);bootstrap(jQuery191);});}else{bootstrap(jQuery);}})();/* */
