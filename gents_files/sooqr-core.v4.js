websight.sooqr.Debug={containerElement:void 0,log:function(message){if(void 0==message)return!1;if(void 0==this.containerElement){this.containerElement=document.createElement("div"),this.containerElement.id="LogWindow",this.containerElement.style.position="absolute",this.containerElement.style.zIndex="10000",this.containerElement.style.top="45px",this.containerElement.style.left="100%",this.containerElement.style.marginLeft="-315px",this.containerElement.style.backgroundColor="#F7F7F7",this.containerElement.style.border="1px solid #DDDDDD",this.containerElement.style.width="300px",this.containerElement.style.padding="5px",document.body.appendChild(this.containerElement);var headerElement=document.createElement("h3");headerElement.style.margin="5px 0px",headerElement.style.fontSize="16px",headerElement.appendChild(document.createTextNode("Debug")),this.containerElement.appendChild(headerElement)}message.toSource&&(message=message.toSource());var messageElement=document.createElement("div");messageElement.appendChild(document.createTextNode(message)),this.containerElement.appendChild(messageElement),this.containerElement.appendChild(document.createElement("HR"))}},function($){$.fn.listHandlers=function(events,outputFunction){return this.each(function(i){var elem=this,dEvents=$(this).data("events");dEvents&&$.each(dEvents,function(name,handler){new RegExp("^("+("*"===events?".+":events.replace(",","|").replace(/^on/i,""))+")$","i").test(name)&&$.each(handler,function(i,handler){outputFunction(elem,"\n"+i+": ["+name+"] : "+handler)})})})}}($jQ),wsDebug=websight.sooqr.Debug.log,websight.sooqr.FilterPanel=function(controllerInstance,parameters,filterQuery){this.controllerInstance=controllerInstance,this.objectName="FilterPanel",this.defaultFilters=this.controllerInstance.parameters.defaultFilters||{},this.defaultSubValues=this.controllerInstance.parameters.defaultSubValues||{},this.parameters=parameters,this.structure=parameters.filters,this.panelElement=$jQ("div.sooqrSearchFilters",controllerInstance.getFilterContainer()),this.formElement=$jQ('<form method="get" action="#"/>'),this.isFilterpanelFixed=!1,this.filterGroupCache={},this.persistentParameters={filtersShowAll:!1,filterValuesShowAll:{}},this.filterContainers={},this.lastInitializedParameters={},this.handleLocationInputTimeout=null,this.lastFilterQuery=filterQuery,this.toArray=function(){var jsonValues={},formValues=this.formElement.serializeArray();for(iValue=0;iValue<formValues.length;iValue++){var filterName=formValues[iValue].name.substring(12);if("[]"==filterName.substring(filterName.length-2)){var filterName=filterName.substring(0,filterName.length-2);filterName in jsonValues||(jsonValues[filterName]=new Array),jsonValues[filterName]instanceof Array?jsonValues[filterName].push(formValues[iValue].value):("values"in jsonValues[filterName]||(jsonValues[filterName].values=new Array),jsonValues[filterName].values.push(formValues[iValue].value))}else if("[_]"==filterName.substring(filterName.length-3)){var filterName=filterName.substring(0,filterName.length-3);filterName in jsonValues||(jsonValues[filterName]={}),jsonValues[filterName]._=formValues[iValue].value}else{var matches;null!==(matches=filterName.match(/^(.+)\[(.+)\]$/))?(matches[1]in jsonValues||(jsonValues[matches[1]]={}),jsonValues[matches[1]][matches[2]]=formValues[iValue].value):jsonValues[filterName]=formValues[iValue].value}}for(k in this.structure)if(this.structure.hasOwnProperty(k)){var fieldData=this.structure[k];switch(fieldData.type){case"radiotree":jsonValues[fieldData.id]._&&!jsonValues[fieldData.id].values&&this.defaultSubValues[fieldData.id]&&this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]&&(jsonValues[fieldData.id].values=[this.defaultSubValues[fieldData.id][jsonValues[fieldData.id]._]]);break;case"slider":break;case"dualslider":var slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement);if(slider.length){var sliderValues=slider.slider("option","values");slider.slider("option","min")==sliderValues[0]&&slider.slider("option","max")==sliderValues[1]||(jsonValues[fieldData.id]={left:slider.slider("option","min"),min:sliderValues[0],max:sliderValues[1],right:slider.slider("option","max")})}}}return 0==jsonValues.length&&(jsonValues=null),this.lastFilterQuery=jsonValues,jsonValues},this.updateRangeSliderMin=function(searchFilter,filterIndex,ui){filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].zeroLabel&&0==ui.values[0]?$jQ("div.searchFilterSliderLegendMin",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].zeroLabel):$jQ("div.searchFilterSliderLegendMin",searchFilter).text(ui.values[0])},this.updateRangeSliderMax=function(searchFilter,filterIndex,ui){filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].zeroLabel&&0==ui.values[1]?$jQ("div.searchFilterSliderLegendMax",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].zeroLabel):filterIndex in this.lastInitializedParameters.filters&&this.lastInitializedParameters.filters[filterIndex].maxLabel&&ui.values[1]==this.lastInitializedParameters.filters[filterIndex].max?$jQ("div.searchFilterSliderLegendMax",searchFilter).text(this.lastInitializedParameters.filters[filterIndex].maxLabel):$jQ("div.searchFilterSliderLegendMax",searchFilter).text(ui.values[1])},this.updateRangeSlider=function(searchFilter,filterIndex,ui){this.updateRangeSliderMin(searchFilter,filterIndex,ui),this.updateRangeSliderMax(searchFilter,filterIndex,ui)},this.handleRangleSlider=function(event,ui){var searchFilter=$jQ(ui.handle).closest("div.searchFilterField"),filterId=searchFilter.attr("rel");if(ui.values[0]==ui.values[1])return!1;this.updateRangeSlider(searchFilter,filterId,ui),searchFilter.addClass("active");var handles=$jQ("a.ui-slider-handle",searchFilter);for(iHandle=0;iHandle<handles.length;iHandle++){var handleLeftOffset=$jQ(handles[iHandle]).css("left");0==iHandle?$jQ("div.searchFilterSliderLegendMin",searchFilter).css("left",handleLeftOffset):$jQ("div.searchFilterSliderLegendMax",searchFilter).css("left",handleLeftOffset)}},this.handleChangedFilterById=function(filterId){additionalParameters={filterInitiated:!0,triggerFilter:filterId},this.controllerInstance.searchCallback.directCallback(additionalParameters),this.panelElement.find('a[rel="reset"]').css("visibility","visible"),$jQ(this.controllerInstance).trigger("filterChanged",[])},this.handleChangedFilter=function(event){var filterId=$jQ(event.target).closest("div.searchFilter").data("filter-id");if("radio"==event.target.type||"radiotree"==event.target.type){var jQTarget=$jQ(event.target);if(0==jQTarget.closest("div.searchFilterFieldTreeSubvalues").length){var matches=event.target.name.match(/searchFilter([0-9]+)/);if(matches){var filterId=matches[1];$jQ("div.searchFilterFieldTreeSubvalues","#sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+filterId).remove()}}for(var filterFields=$jQ("div.searchFilterField",$jQ(event.target).closest("div.searchFilterValues")).not(jQTarget.parents()),radioInputs=$jQ('input[type="radio"]',filterFields),iInput=0;iInput<radioInputs.length;iInput++)radioInputs.eq(iInput).siblings().removeClass("active")}$jQ(event.target).siblings().length>0?$jQ(event.target).siblings().toggleClass("active"):$jQ(event.target).closest(".searchFilterField ").find('label, span[rel="results"]').toggleClass("active"),this.handleChangedFilterById(filterId)},this.handleQueryFilter=function(event){var labels=$jQ(event.target).siblings("label");labels.length&&this.controllerInstance.setQueryText(labels.first().text()),event.preventDefault()},this.showAllFilters=function(){return this.persistentParameters.filtersShowAll=!0,additionalParameters={filterInitiated:!0,enableFiltersShowAll:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters),!1},this.toggleAllFilterValues=function(event,state){if(event.stopPropagation(),event.preventDefault(),event.currentTarget.rel){var filterId=event.currentTarget.rel;state?this.persistentParameters.filterValuesShowAll[filterId]=!0:delete this.persistentParameters.filterValuesShowAll[filterId],additionalParameters={filterInitiated:!0},this.controllerInstance.searchCallback.directCallback(additionalParameters)}return!1},this.showAllFilterValues=function(event){return this.toggleAllFilterValues(event,!0)},this.hideAllFilterValues=function(event){return this.toggleAllFilterValues(event,!1)},this.disableOtherSelects=function(){var searchFilter=$jQ(this).closest("div.searchFilter");searchFilter.hasClass("disabled")||(searchFilters=$jQ('div.searchFilterField input[type = "checkbox"]',searchFilter).not(this).prop("checked",!1),$jQ(searchFilters).siblings().removeClass("active"))},this.togglePanel=function(state){this.panelElement.css("visibility",state?"visible":"hidden"),0==state&&(this.filterGroupCache={})},this.updateFilters=function(parameters,queryParameters){for(var initFilters=0,hasActiveFilterOptions=!1,newFilters=[],iFilter=0;iFilter<parameters.filters.length;iFilter++)newFilters.push(parseInt(parameters.filters[iFilter].id));for(var iFilter=0;iFilter<this.lastInitializedParameters.filters.length;iFilter++)if(-1==$jQ.inArray(parseInt(this.lastInitializedParameters.filters[iFilter].id),newFilters)){var filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+this.lastInitializedParameters.filters[iFilter].id,filterObject=$jQ("div#"+filterHtmlId);filterObject.remove()}for(k in parameters.filters)if(parameters.filters.hasOwnProperty(k)){for(var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,filterObject=$jQ("div#"+filterHtmlId),filterOptions={},i=1;void 0!=parameters.filters[k-i];){var previousFieldData=parameters.filters[k-i],previousFilterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+previousFieldData.id;if($jQ("div#"+previousFilterHtmlId).length){filterOptions.previousFilterHtmlId=previousFilterHtmlId;break}i++}if(filterOptions.filterValuesShowAll=parameters.filterValuesShowAll,0!=filterObject.length){switch(fieldData.type){case"manualSorter":case"select":case"mapper":case"multiselect":case"ranges":case"query":case"yesno":case"tree":case"radio":case"radiotree":if(this.controllerInstance.hideEmptyFilters){if(!("values"in fieldData&&0!=fieldData.values.length)){filterObject.hide();continue}filterObject.show()}if("values"in fieldData&&0!=fieldData.values.length&&(hasActiveFilterOptions=!0),null!=parameters.filterValuesShowAll&&void 0!==parameters.filterValuesShowAll[fieldData.id]&&!0===parameters.filterValuesShowAll[fieldData.id]&&(null==this.lastInitializedParameters.filterValuesShowAll||void 0===this.lastInitializedParameters.filterValuesShowAll[fieldData.id])){this.addFilter(k,fieldData,filterObject,filterOptions);continue}var existingFilterObjects=$jQ("div.searchFilterValues > div.searchFilterField",filterObject),existingFilters={};for(iFilter=0;iFilter<existingFilterObjects.length;iFilter++)""!=$jQ(existingFilterObjects[iFilter]).attr("rel")&&(existingFilters[$jQ(existingFilterObjects[iFilter]).attr("rel")]=existingFilterObjects[iFilter]);var missingValue=!1;for(var v in fieldData.values)if(fieldData.values.hasOwnProperty(v)){var filterField=$jQ('div.searchFilterField[rel="'+this.parseRel(v)+'"]',filterObject);0==filterField.length&&(missingValue=!0)}if(missingValue){this.addFilter(k,fieldData,filterObject,filterOptions);continue};for(var k in fieldData.values)if(fieldData.values.hasOwnProperty(k)){var filterField=$jQ('div.searchFilterField[rel="'+this.parseRel(k)+'"]',filterObject);if(1==filterField.length){if(filterField=filterField.eq(0),filterField.data("count",fieldData.values[k].c),filterField.removeClass("disabled"),0==fieldData.values[k].c&&"query"!=fieldData.type)filterField.toggleClass("disabled",!0),$jQ("input",filterField).toggleClass("disabled",!0),"select"==fieldData.type||"yesno"==fieldData.type||"tree"==fieldData.type?this.toggleInput($jQ("input",htmlObject),fieldData,!1):"radio"==fieldData.type&&this.toggleInput($jQ("input",filterField),fieldData,!1);else{if(filterField.removeClass("disabled"),"manualSorter"==fieldData.type||"mapper"==fieldData.type||"radio"==fieldData.type||"multiselect"==fieldData.type){var attr=$jQ("input",filterField).attr("disabled");void 0!==attr&&!1!==attr&&$jQ("input",filterField).prop("checked",!1),$jQ("input",filterField).removeClass("disabled").prop("disabled",!1)}this.toggleInput($jQ("input",filterField),fieldData,!0)}if("radio"==fieldData.type&&(fieldData.values[k].a?$jQ("input",filterField).attr("checked","checked").siblings().addClass("active"):$jQ("input",filterField).prop("checked",!1).siblings().removeClass("active")),filterField.children('span[rel="results"]').html(this.getResultCountString(fieldData.values[k].c)),existingFilters[this.parseRel(k)]=null,"tree"==fieldData.type||"radiotree"==fieldData.type)if(fieldData.subvalues&&fieldData.subvalues[k]&&websight.util.propCount(fieldData.subvalues[k])){var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),subvalueContainer=$jQ("div.searchFilterFieldTreeSubvalues",filterField);if(0!=subvalueContainer.length)for(var subValues=$jQ('div.searchFilterField[rel^="'+this.parseRel(k)+'|"]',subvalueContainer),iValue=0;iValue<subValues.length;iValue++){var subRel=subValues.eq(iValue).attr("rel").split(/\|/);subRel[1]in fieldData.subvalues[k]?($jQ(subValues.eq(iValue)).children('span[rel="results"]').html(this.getResultCountString(fieldData.subvalues[k][subRel[1]].c)),subValues.eq(iValue).removeClass("disabled"),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!0)):($jQ(subValues.eq(iValue)).children('span[rel="results"]').html(this.getResultCountString(0)),subValues.eq(iValue).toggleClass("disabled",!0),this.toggleInput($jQ(subValues.eq(iValue)).children("input"),fieldData,!1))}else this.addSubvalues(k,filterField,fieldData,valueId)}else $jQ("div.searchFilterFieldTreeSubvalues",filterField).remove(),filterField.css("height","1.7em").css("overflow","hidden")}}if("radio"!=fieldData.type&&"radiotree"!=fieldData.type)for(var k in existingFilters)if(null!=existingFilters[k]){if(0==$jQ("input:checked",existingFilters[k]).length){$jQ(existingFilters[k]).toggleClass("disabled",!0);var filterInput=$jQ("input",existingFilters[k]);this.toggleInput(filterInput,fieldData,!1)}$jQ('span[rel="results"]',existingFilters[k]).html(this.getResultCountString(0))}break;case"dualslider":if(this.controllerInstance.hideEmptyFilters){filterObject.toggle(!(fieldData.min==fieldData.max));continue}var slider=$jQ('div.searchFilter[data-filter-id="'+fieldData.id+'"] div.searchFilterField div.searchFilterSlider',this.panelElement),currentValues=slider.slider("option","values");if(!("filterQuery"in queryParameters)||!(fieldData.id in queryParameters.filterQuery)||currentValues[0]==fieldData.min&&currentValues[1]==fieldData.max||currentValues[0]>queryParameters.filterQuery[fieldData.id].min||currentValues[1]<queryParameters.filterQuery[fieldData.id].max){slider.slider({change:null});var realMin=realMax=left=right=0;fieldData.id in queryParameters.filterQuery?(left=queryParameters.filterQuery[fieldData.id].left,right=queryParameters.filterQuery[fieldData.id].right,realMin=Math.min(fieldData.min,queryParameters.filterQuery[fieldData.id].min),realMax=Math.max(fieldData.max,queryParameters.filterQuery[fieldData.id].max)):(left=realMin=fieldData.min,right=realMax=fieldData.max),slider.slider("option","min",left),slider.slider("option","max",right),slider.slider("option","step",Math.round((right-left)/Math.min(right-left,fieldData.steps?fieldData.steps:50))),slider.slider("option","values",[realMin,realMax]),this.updateRangeSlider(filterObject,k,{values:[realMin,realMax]}),slider.slider({change:$jQ.proxy(this.handleChangedFilter,this)})}}initFilters++}else filterOptions.animation=!0,this.addFilter(k,fieldData,null,filterOptions)}const versionIE=detectIE();versionIE&&versionIE>=8&&$jQ("html,body").scroll(),hasActiveFilterOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible"),this.lastInitializedParameters=parameters},this.getResultCountString=function(results){return this.controllerInstance.indexSettings.view.cssVersion>=4?results:"("+results+")"},this.toggleInput=function(input,fieldData,state){input.off("change").off("click"),state?this.bindChangeEvent(fieldData,input):input.on("click",function(event){return event.preventDefault(),!1}).on("change",function(event){return event.preventDefault(),!1})},this.getFilterGroup=function(groupId){if(null==groupId&&(groupId=0),groupId in this.filterGroupCache)return this.filterGroupCache[groupId];var groupConfiguration=null;this.controllerInstance.indexSettings.filterGroups&&(groupConfiguration=this.controllerInstance.indexSettings.filterGroups[groupId]),null==groupConfiguration&&(groupConfiguration={name:"",default_collapsed:!1,collapsible:!1});var additionalClasses=1==groupConfiguration.default_collapsed?" closed":"";additionalClasses+=1==groupConfiguration.collapsible?" collapsible":"";var additionalStyle=0==groupConfiguration.default_collapsed?"":"display: none;",groupObject=$jQ('<div class="searchFilterGroup'+additionalClasses+'">'+(1==groupConfiguration.collapsible?'<div class="searchFilterGroupToggle"> </div>':"")+(groupConfiguration.name.length?"<h2>"+groupConfiguration.name+"</h2>":"")+'<div class="searchFilterGroupContainer" style="'+additionalStyle+'"> </div></div>').first();return this.formElement.append(groupObject),this.filterGroupCache[groupId]=groupObject,groupObject},this.getHeight=function(){return this.panelElement.outerHeight()},this.initialFilterTop=this.panelElement.offset().top,this.lastScrollTop=websight.util.getWindowScrollTop(),this.fixedFiltersCallback=function(){var containerOffset=controllerInstance.container.offset(),containerBottom=controllerInstance.container.height()+containerOffset.top,windowHeight=$jQ(window).height(),filterHeight=this.panelElement.outerHeight(!0),scrollTop=websight.util.getWindowScrollTop(),scrollBottom=Math.min(containerBottom,scrollTop+windowHeight),filterTop=this.panelElement.offset().top,filterBottom=filterTop+filterHeight,footerSpace=Math.max(0,scrollTop+windowHeight-containerBottom),availableWindowHeight=windowHeight-footerSpace,heightDelta=Math.abs(availableWindowHeight-filterHeight),scrollDelta=this.lastScrollTop-scrollTop,scrollingDown=scrollTop>this.lastScrollTop,fitsInWindow=availableWindowHeight>filterHeight;if(controllerInstance.container.css("min-height").replace(/px$/,"")<filterHeight&&controllerInstance.container.css("min-height",filterHeight+"px"),fitsInWindow&&scrollTop>this.initialFilterTop||!fitsInWindow&&scrollTop>this.initialFilterTop+heightDelta?this.panelElement.hasClass("sqr-fixed")||(this.panelElement.addClass("sqr-fixed").css({position:"fixed"}),this.updatePanelWidth()):!scrollingDown&&scrollTop<=this.initialFilterTop&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.updatePanelWidth()),this.isFilterpanelFixed=this.panelElement.hasClass("sqr-fixed"),this.isFilterpanelFixed){var leftOffset=-$jQ(window).scrollLeft()+containerOffset.left;leftOffset<0?this.panelElement.css("left",leftOffset):this.panelElement.css("left","auto")}var dragDown=filterBottom<=scrollBottom&&scrollingDown,dragUp=filterTop>=scrollTop&&!scrollingDown;if(dragDown&&fitsInWindow||dragUp)this.panelElement.css("top",0);else if(dragDown&&this.isFilterpanelFixed)this.panelElement.css("top",-heightDelta);else if(this.isFilterpanelFixed){var currentTop=parseInt(this.panelElement.css("top"),10),minTop=-heightDelta,scrolledTop=currentTop+scrollDelta,isPageAtBottom=scrollTop+windowHeight>=$jQ(document).height(),newTop=isPageAtBottom?minTop:scrolledTop;this.panelElement.css("top",newTop)}this.lastScrollTop=scrollTop},this.updatePanelWidth=function(){if(this.controllerInstance.indexSettings.view.cssVersion>=4){var resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left");this.panelElement.css("width",resultsMargin)}},this.handleFilterFloatOnScroll=function(event){if(0==this.filterFloatInit){this.controllerInstance.parameters.filterContainer&&(filtersSelector=this.controllerInstance.parameters.filterContainer);$jQ(window).on("scroll",this.proxiedFunctions.fixedFiltersCallback),this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback(),$jQ(this.controllerInstance).on("updateFilters",$jQ.proxy(function(){this.filterFloatInit&&(this.lastScrollTop=0,this.proxiedFunctions.fixedFiltersCallback())},this)),this.filterFloatInit=!0}},this.disableFilterFloatOnScroll=function(){$jQ(window).off("scroll",this.proxiedFunctions.fixedFiltersCallback),this.filterFloatInit&&(this.panelElement.removeClass("sqr-fixed").css({position:"relative",top:"",left:"",width:""}),this.filterFloatInit=!1)},this.hasFloatingFilters=function(){return"filterFloatOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.filterFloatOnScroll&&!websight.util.isTouch()},this.initializePanel=function(parameters){if(this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),void 0!=parameters&&(this.parameters=parameters,this.structure=this.parameters.filters),this.panelElement.css("visibility","hidden"),this.panelElement.empty(),this.formElement.empty(),this.filterGroupCache={},this.parameters.html){var template=$jQ(this.parameters.html);this.panelElement.append(template);$jQ("div.filters, div.sqr-filters",this.panelElement).append(this.formElement)}else this.panelElement.append(this.formElement);for(k in this.structure)this.addFilter(k,this.structure[k]);this.initializeClicks(),this.panelElement.css("visibility","visible"),this.panelElement.find('a[rel="reset"]').on("click",$jQ.proxy(this.controllerInstance.resetFilters,this.controllerInstance)),this.lastInitializedParameters=this.parameters},this.clearLastFilterQuery=function(){this.lastFilterQuery=null},this.findMappedValue=function(values,value,type){for(var key in values)if(values[key].value==value&&values[key][type])return values[key][type];return!1},this.addFilter=function(k,fieldData,replaceObject,options){if(void 0==replaceObject&&(replaceObject=null),void 0==options&&(options={}),void 0!=fieldData){var hasActiveOptions=!1;if(!("fixedFilters"in this.controllerInstance.parameters&&(fieldData.id in this.controllerInstance.parameters.fixedFilters||fieldData.code in this.controllerInstance.parameters.fixedFilters))){var sortedValues=[];for(var l in fieldData.values)sortedValues[fieldData.values[l].p]=l;var filterGroup=filterGroupContainer=null;filterGroup=this.getFilterGroup(fieldData.group_id),filterGroupContainer=$jQ("div.searchFilterGroupContainer",filterGroup);var filterHtml="",filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id,currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id]?currentValue=this.lastFilterQuery[fieldData.id]:this.defaultFilters[fieldData.id]&&(currentValue=this.defaultFilters[fieldData.id]);var extraClasses=extraFilterClasses="",filterValuesShowAll=!1;switch(null!=options.filterValuesShowAll&&fieldData.id in options.filterValuesShowAll&&1==options.filterValuesShowAll[fieldData.id]&&(filterValuesShowAll=!0),1==fieldData.collapsed&&0==filterValuesShowAll&&(extraFilterClasses+=" collapsed"),fieldData.type){case"query":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+'" rel="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else for(var index in sortedValues){var l=sortedValues[index],valueId=filterHtmlId+"Value"+l.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+'" rel="'+this.parseRel(l)+'"><input type="checkbox" id="'+valueId+'" name="searchFilter'+fieldData.id+'" value="'+l+'" /> <label for="'+valueId+'">'+fieldData.values[l].l+"</label> </div>"}break;case"tree":case"radiotree":case"select":case"yesno":case"radio":if($jQ.isEmptyObject(fieldData.values))filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><label>Geen filter mogelijkheden</label></div>';else{var checked=!1,widgetType=fieldData.type.match(/^radio/)?"radio":"checkbox",singleOption=!1;for(var index in sortedValues){var l=sortedValues[index];if(fieldData.values.hasOwnProperty(l)){var extraLabelClasses=extraSpanClasses="",extraItemClasses=0==fieldData.values[l].c?" disabled":"";switch(inputDisabled=singleOption||0==fieldData.values[l].c?' disabled="disabled"':"",valueMatch=!1,fieldData.type){case"tree":case"radiotree":valueMatch=currentValue&&currentValue._==l;break;case"select":null!=currentValue&&(valueMatch=currentValue==l);break;case"radio":case"yesno":valueMatch=fieldData.values[l].a}checked=singleOption||valueMatch,inputDisabled+=checked?' checked="checked"':"",checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+l.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),fieldName="searchFilter"+fieldData.id;"tree"!=fieldData.type&&"radiotree"!=fieldData.type||(fieldName+="[_]");var fieldHtml='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(l)+'"><input type="'+widgetType+'" '+inputDisabled+' id="'+valueId+'" name="'+fieldName+'" value="'+l+'" /> <label for="'+valueId+'" class="'+extraLabelClasses+'">'+fieldData.values[l].l+'</label> <span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[l].c)+"</span></div>";if(("tree"==fieldData.type||"radiotree"==fieldData.type)&&fieldData.subvalues&&fieldData.subvalues[l]&&websight.util.propCount(fieldData.subvalues[l])){var htmlObject=$jQ(fieldHtml).first();this.addSubvalues(l,htmlObject,fieldData,valueId),fieldHtml=$jQ("<div></div>").append(htmlObject).html()}filterHtml+=fieldHtml}}}break;case"mapper":var singleOption=!1;for(var index in sortedValues){var k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){var extraLabelClasses=extraSpanClasses="";extraItemClasses=0==fieldData.values[k].c?" disabled":"",inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",valueMatch=fieldData.values[k].a,checked=singleOption||valueMatch;var checkedStr="";checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");switch(filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" />',fieldData.optionType){case"customImageMapping":case"useValueAsImage":var url="useValueAsImage"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"image");url?(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+='<img src="'+url+'" alt="'+fieldData.values[k].l+'" /></label> '):(filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l+"</label> ");break;case"customLabelMapping":filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">';var label=this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"label");filterHtml+=label||fieldData.values[k].l,filterHtml+="</label> ";break;case"customHexMapping":case"useValueAsHex":var hex="useValueAsHex"==fieldData.optionType?fieldData.values[k].l:this.findMappedValue(fieldData.value_settings,fieldData.values[k].l,"hex");hex?(hex=hex.indexOf("#")>-1?hex:"#"+hex,filterHtml+='<label style="color:'+hex+'" for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'):filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">',filterHtml+=fieldData.values[k].l,filterHtml+="</label> ";break;default:filterHtml+='<label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+"</label> "}filterHtml+='<span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"manualSorter":case"multiselect":case"ranges":var singleOption=!1;for(var index in sortedValues){var k=sortedValues[index];if(fieldData.values.hasOwnProperty(k)){var extraLabelClasses=extraSpanClasses="";switch(extraItemClasses=0==fieldData.values[k].c?" disabled":"",inputDisabled=singleOption||0==fieldData.values[k].c?' disabled="disabled"':"",fieldData.type){case"manualSorter":case"mapper":case"multiselect":valueMatch=fieldData.values[k].a;break;default:valueMatch=currentValue==k}checked=singleOption||valueMatch;var checkedStr="";checked&&(extraLabelClasses+=" active",extraSpanClasses+=" active",checkedStr=' checked="checked"',hasActiveOptions=!0);var valueId=filterHtmlId+"Value"+k.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),title=fieldData.values[k].l.replace(/\<\!\-\-.+\-\-\>/,"");filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+extraClasses+extraItemClasses+'" rel="'+this.parseRel(k)+'"><input type="checkbox" '+inputDisabled+checkedStr+' id="'+valueId+'"  name="searchFilter'+fieldData.id+'[]" value="'+k+'" /> <label for="'+valueId+'" title="'+title+'" class="'+extraLabelClasses+'">'+fieldData.values[k].l+'</label> <span rel="results" class="'+extraSpanClasses+'">'+this.getResultCountString(fieldData.values[k].c)+"</span></div>"}}break;case"slider":case"dualslider":var settings=this.getSliderSettings(fieldData);if(settings.min!=settings.max){var minLabel=settings.min;0==settings.min&&fieldData.zeroLabel&&(minLabel=fieldData.zeroLabel);var maxLabel=settings.max;fieldData.maxLabel&&fieldData.hasMaxInt&&(maxLabel=fieldData.maxLabel),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><div class="searchFilterSliderLegendMin">'+minLabel+'</div><div class="searchFilterSlider"></div><div class="searchFilterSliderLegendMax">'+maxLabel+"</div></div>"}break;case"location":var distanceUnit="km";"miles"===fieldData.distanceUnits&&(distanceUnit="mi."),filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+'"><div class="sqr-result-info" onclick="$jQ(this).hide();" id="'+filterHtmlId+'Response"></div><input autocomplete="off" type="text" id="'+filterHtmlId+'Search"/><i class="sqr-location-clear sqr-icon sqr-icon-cancel-circle"></i><input type="hidden" data-location id="'+filterHtmlId+'Location" name="searchFilter'+fieldData.id+'[location]"/><input type="hidden" data-distance id="'+filterHtmlId+'Distance" name="searchFilter'+fieldData.id+'[distance]" value="'+fieldData.defaultDistance+'" /><ul class="sqr-location-suggest" id="'+filterHtmlId+'SuggestValues"><li></li></ul><a href="#" id="'+filterHtmlId+'Geolocate"><i class="sqr-icon sqr-icon-gps"></i> '+this.parameters.locationGetCurrentText+'</a><div class="sqr-distance-label">'+this.parameters.locationDistanceText+' <span class="sqr-distance-value">'+fieldData.defaultDistance+'</span> <span class="sqr-distance-unit">'+distanceUnit+'</span></div> <div class="searchFilterSlider"></div></div>'}if(filterHtml.length){
var html='<div class="searchFilter'+extraFilterClasses+'" data-filter-id="'+fieldData.id+'" id="'+filterHtmlId+'"><label>'+fieldData.label+'</label><div class="searchFilterValues">'+filterHtml+"</div></div>",htmlObject=$jQ(html);switch(fieldData.type){case"manualSorter":case"mapper":case"tree":case"radiotree":case"select":case"radio":case"yesno":case"multiselect":fieldData.moreValues&&htmlObject.append('<div class="searchFilterShowAllValues"><a href="#" rel="'+fieldData.id+'">'+this.parameters.moreOptionsText+"</a></div>")}switch(null!=replaceObject?$jQ(replaceObject).replaceWith(htmlObject):void 0!=options.previousFilterHtmlId&&$jQ("div#"+options.previousFilterHtmlId).length>0?filterGroupContainer.find("div#"+options.previousFilterHtmlId).after(htmlObject):filterGroupContainer.append(htmlObject),"function"==typeof this.getFilter&&!1===this.getFilter(fieldData.id)&&(this.structure[this.structure.length]=fieldData),fieldData.type){case"manualSorter":case"mapper":case"multiselect":case"select":$jQ("div.searchFilterValues",htmlObject).css("min-height",$jQ("div.searchFilterValues",htmlObject).height()+"px");case"query":case"tree":case"yesno":case"ranges":case"radio":case"radiotree":this.bindChangeEvent(fieldData,$jQ("input",htmlObject));break;case"slider":$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.min+";"+fieldData.max),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.min,max:fieldData.max,value:fieldData.min,step:Math.round((fieldData.max-fieldData.min)/Math.min(fieldData.max-fieldData.min,fieldData.steps?fieldData.steps:50)),change:$jQ.proxy(this.handleChangedFilter,this)});break;case"dualslider":var sliderContainer=$jQ("div#"+filterHtmlId+" div.searchFilterSlider"),settings=this.getSliderSettings(fieldData);$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:settings.left,max:settings.right,step:fieldData.step?fieldData.step:Math.round((settings.max-settings.min)/Math.min(settings.max-settings.min,fieldData.steps?fieldData.steps:50)),range:!0,values:[settings.min,settings.max],change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(this.handleRangleSlider,this)}),$jQ("a.ui-slider-handle",sliderContainer).first().addClass("ui-slider-handle-left"),$jQ("a.ui-slider-handle",sliderContainer).last().addClass("ui-slider-handle-right");break;case"location":var locationInput=htmlObject.find('input[type="text"]');$jQ("a",htmlObject).on("click",$jQ.proxy(function(event){event.preventDefault(),this.getGeolocation(fieldData,htmlObject)},this)),$jQ("ul",htmlObject).on("click","li",$jQ.proxy(function(event){this.handleGeoResultClick(event.currentTarget,locationInput)},this)),this.bindChangeEvent(fieldData,locationInput),$jQ(".sqr-location-clear",htmlObject).on("click",$jQ.proxy(function(event){this.clearGeoFilter(fieldData.id,!0)},this)),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").attr("value",fieldData.defaultDistance),$jQ("div#"+filterHtmlId+" div.searchFilterSlider").slider({min:fieldData.minimumDistance,max:fieldData.maximumDistance,value:fieldData.defaultDistance,step:fieldData.distanceStep,range:"min",change:$jQ.proxy(this.handleChangedFilter,this),slide:$jQ.proxy(function(event,ui){$jQ(event.target).siblings(".sqr-distance-label").find(".sqr-distance-value").text(ui.value),$jQ(event.target).siblings('input[data-distance=""]').val(ui.value)},this)})}this.initializeClicksByFields($jQ("div#"+filterHtmlId))}hasActiveOptions&&this.panelElement.find('a[rel="reset"]').css("visibility","visible")}}},this.getSliderSettings=function(fieldData){var settings={"left":fieldData.min,"right":fieldData.max,"min":fieldData.min,"max":fieldData.max};if(null!=this.lastFilterQuery&&fieldData.id in this.lastFilterQuery){var options=["left","right","min","max"];for(name in options)key=options[name],settings[key]=this.lastFilterQuery[fieldData.id][key]}return settings},this.bindChangeEvent=function(fieldData,selector){switch(fieldData.type){case"query":selector.on("change",$jQ.proxy(function(event){this.handleQueryFilter(event)},this));break;case"location":selector.on("keydown",$jQ.proxy(function(event){this.handleLocationSubmit(event,fieldData,selector)},this)),selector.on("keyup",$jQ.proxy(function(event){this.handleLocationInput(event,fieldData,selector)},this));break;case"tree":case"select":case"yesno":selector.on("change",this.disableOtherSelects);case"manualSorter":case"mapper":case"ranges":case"multiselect":case"radio":case"radiotree":selector.on("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))}},this.checkSingleOption=function(values){var singleOption=!1,resultTotal=0;for(var k in values)values[k].c&&(resultTotal+=parseInt(String(values[k].c).replace(/\./,"")));return resultTotal==this.parameters.numberOfResults&&1==websight.util.propCount(values)&&(singleOption=!0),singleOption},this.showHiddenFilters=function(parameters){this.parameters=parameters,this.structure=this.parameters.filters;for(k in parameters.filters){var fieldData=parameters.filters[k],filterHtmlId="sooqr"+this.controllerInstance.parameters.view+"SearchFilter"+fieldData.id;0==$jQ("div#"+filterHtmlId).length&&this.addFilter(k,fieldData)}},this.addSubvalues=function(k,filterField,fieldData,valueId){subvalueContainer=$jQ('<div class="searchFilterFieldTreeSubvalues"/>'),subvalueContainer.appendTo(filterField),subvalueContainer=subvalueContainer.first();var currentValue=null;null!=this.lastFilterQuery&&this.lastFilterQuery[fieldData.id].values&&this.lastFilterQuery[fieldData.id]._==k?currentValue=this.lastFilterQuery[fieldData.id].values:this.defaultFilters&&this.defaultFilters[fieldData.id]&&this.defaultFilters[fieldData.id]._==k&&this.defaultFilters[fieldData.id].values&&(currentValue=this.defaultFilters[fieldData.id].values);var filterHtml="",iItem=0;for(var l in fieldData.subvalues[k]){if(fieldData.subvalues[k].hasOwnProperty(l)){var subValueId=valueId+"_"+l.replace(/[^0-9a-zα-ωΑ-Ω]/gi,"_"),elementType="radiotree"==fieldData.type?"radio":"checkbox",isCurrentValue=!1;isCurrentValue=null==currentValue?0==iItem:currentValue==l;var checked="radiotree"==fieldData.type&&isCurrentValue?' checked="checked"':"",extraClasses="radiotree"==fieldData.type&&isCurrentValue?"active":"";filterHtml+='<div class="searchFilterField searchFilterField'+websight.util.ucFirst(fieldData.type)+'" rel="'+this.parseRel(k)+"|"+this.parseRel(l)+'"><input type="'+elementType+'" id="'+subValueId+'" name="searchFilter'+fieldData.id+'[]" '+checked+' value="'+l+'" /> <label for="'+subValueId+'" class="'+extraClasses+'">'+fieldData.subvalues[k][l].l+'</label> <span rel="results" class="'+extraClasses+'">'+this.getResultCountString(fieldData.subvalues[k][l].c)+"</span></div>"}iItem++}filterField.css("height","auto").css("overflow","auto"),subvalueContainer.html(filterHtml),$jQ("input",subvalueContainer).on("change",$jQ.proxy(function(event){this.handleChangedFilter(event)},this))},this.toggleFilterGroup=function(event){var groupObject=$jQ(event.target).closest("div.searchFilterGroup"),collapsed=$jQ("div.searchFilterGroupContainer div.searchFilter.collapsed",groupObject).length,doCollapse=!0;collapsed>0&&(doCollapse=collapsed<$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).length),$jQ("div.searchFilterGroupContainer div.searchFilter",groupObject).toggleClass("collapsed",doCollapse),groupObject.toggleClass("collapsed")},this.toggleFilter=function(event){$jQ(event.target).closest("div.searchFilter").toggleClass("collapsed")},this.handleResponsiveResize=function(activeBreakpoint,newBreakpoint){if(null!=activeBreakpoint&&null==newBreakpoint?this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()):null==activeBreakpoint&&null!=newBreakpoint&&this.hasFloatingFilters()&&this.disableFilterFloatOnScroll(),null==activeBreakpoint){var resultsMargin=this.controllerInstance.searchCallback.resultsPanel.resultContainer.parent().css("margin-left");this.panelElement.css("width",resultsMargin)}},this.handleOpen=function(){this.hasFloatingFilters()&&(this.filterFloatInit=!1,this.proxiedFunctions.handleFilterFloatOnScroll()),this.updatePanelWidth()},this.handleClose=function(){this.hasFloatingFilters()&&this.disableFilterFloatOnScroll()},this.handleLocationSubmit=function(event,fieldData,inputField){var suggestions=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");if(13!=event.keyCode);else if(event.preventDefault(),event.stopImmediatePropagation(),suggestions.find("li").is(":visible")){suggestions.hide(),resultInfoObj.hide();var firstItem=suggestions.find("li").eq(0);this.handleGeoResultClick(firstItem,inputField)}},this.handleLocationInput=function(event,fieldData,inputField){var suggestions=$jQ(inputField).siblings(".sqr-location-suggest"),resultInfoObj=$jQ(inputField).siblings(".sqr-result-info");if(event.keyCode>=65||event.keyCode>=48&&event.keyCode<=57||8==event.keyCode||32==event.keyCode||46==event.keyCode||0==event.keyCode)if(this.handleLocationInputTimeout&&(clearTimeout(this.handleLocationInputTimeout),this.handleLocationInputTimeout=null),0==$jQ(event.target).val().length)suggestions.hide(),resultInfoObj.hide();else{var self=this;this.handleLocationInputTimeout=setTimeout($jQ.proxy(function(){$jQ.ajax({url:"https://api.sooqr.com/v1/geo/search",jsonp:"callback",dataType:"jsonp",data:{query:$jQ(event.target).val(),country:fieldData.countries,group:"city",results:10},success:function(response){if(response.results&&response.results.length){suggestions.empty();for(var k in response.results)suggestions.append('<li data-latitude="'+response.results[k].latitude+'" data-longitude="'+response.results[k].longitude+'"><a>'+response.results[k].name+", "+response.results[k].countrycode+" ("+response.results[k].postalcode+")</a></li>");suggestions.show(),resultInfoObj.hide()}else suggestions.hide(),self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this),200)}},this.toggleGeoFieldReadonly=function(inputField,state){inputField.attr("readonly",!!state&&"readonly"),inputField.toggleClass("sqr-readonly",state)},this.handleGeoResultClick=function(item,inputField){item=$jQ(item),inputField.val(item.text()),this.toggleGeoFieldReadonly(inputField,!0),inputField.siblings('input[data-location=""]').val(item.data("latitude")+","+item.data("longitude")),inputField.siblings("ul").hide(),inputField.siblings(".sqr-location-clear").show();var filterId=$jQ(inputField).closest("div.searchFilter").data("filter-id");this.handleChangedFilterById(filterId)},this.getGeolocation=function(filterObject,htmlObject){var resultInfoObj=htmlObject.find(".sqr-result-info");navigator.geolocation?navigator.geolocation.getCurrentPosition($jQ.proxy(function(position){var self=this;$jQ.ajax({url:"https://api.sooqr.com/v1/geo/near",jsonp:"callback",dataType:"jsonp",data:{lat:position.coords.latitude,lng:position.coords.longitude,country:filterObject.countries,results:1},success:function(response){var inputField=$jQ("input",htmlObject);if(response.results&&response.results.length){var dummyItem=$jQ('<li data-latitude="'+response.results[0].latitude+'" data-longitude="'+response.results[0].longitude+'"><a>'+response.results[0].name+", "+response.results[0].countrycode+" ("+response.results[0].postalcode+")</a></li>");self.handleGeoResultClick(dummyItem,htmlObject.find('input[type="text"]')),self.processGeoResultInfo(resultInfoObj,self.parameters.locationFoundText)}else self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText),self.toggleGeoFieldReadonly(inputField,!1)},error:function(response){self.processGeoResultInfo(resultInfoObj,self.parameters.locationNotFoundText)}})},this)):this.processGeoResultInfo(resultInfoObj,this.parameters.locationNotSupportedText)},this.processGeoResultInfo=function(resultInfoObj,resultInfo){resultInfo&&resultInfoObj.text(resultInfo).fadeIn(400,function(){setTimeout(function(){resultInfoObj.fadeOut()},5e3)})},this.getFilter=function(filterId){for(k in this.structure)if(this.structure.hasOwnProperty(k)&&this.structure[k].id==filterId)return this.structure[k];return!1},this.getFilterType=function(filterId){var filter=this.getFilter(filterId);return!1!==filter&&filter.type},this.clearGeoFilter=function(filterId,refresh){var htmlObject=$jQ('div[data-filter-id="'+filterId+'"]',this.panelElement);$jQ(htmlObject).find(".sqr-result-info").hide(),$jQ(htmlObject).siblings(".sqr-location-suggest").hide(),$jQ(htmlObject).find('input[type="text"], input[data-location=""]').val(""),$jQ(htmlObject).find(".sqr-location-clear").hide(),this.toggleGeoFieldReadonly(htmlObject.find('input[type="text"]'),!1),refresh&&this.handleChangedFilterById(filterId)},this.proxiedFunctions={handleFilterFloatOnScroll:$jQ.proxy(this.handleFilterFloatOnScroll,this),fixedFiltersCallback:$jQ.proxy(this.fixedFiltersCallback,this),handleOpen:$jQ.proxy(this.handleOpen,this),handleClose:$jQ.proxy(this.handleClose,this)},this.initializeClicks=function(){if($jQ("div.searchFilterGroup.collapsible h2, div.searchFilterGroup div.searchFilterGroupToggle",this.formElement).on("click",$jQ.proxy(function(event){this.toggleFilterGroup(event),event.stopPropagation()},this)),this.parameters.hasHiddenFilters){var moreFiltersBlock=$jQ('<div class="searchFilterShowAllFilters"><a href="#">Toon alle filters</a></div>');this.panelElement.append(moreFiltersBlock),$jQ("a",moreFiltersBlock).on("click",$jQ.proxy(this.showAllFilters,this))}},this.initializeClicksByFields=function(fields){return $jQ("label:first",fields).on("click",$jQ.proxy(function(event){this.toggleFilter(event),event.stopPropagation()},this)),$jQ(fields).on("click","div.searchFilterShowAllValues a",$jQ.proxy(function(event){return this.showAllFilterValues(event)},this)),$jQ(fields).on("click","div.searchFilterHideAllValues a",$jQ.proxy(function(event){return this.hideAllFilterValues(event)},this)),fields},this.parseRel=function(rel){return rel.replace("\x3c!--","commentStart").replace("--\x3e","commentEnd").replace("/","").replace('"',"doublequote")},$jQ(this.controllerInstance).on("open",this.proxiedFunctions.handleOpen),$jQ(this.controllerInstance).on("close",this.proxiedFunctions.handleClose),this.initializePanel()},/*! jQuery UI - v1.12.1 - 2016-09-14
 * http://jqueryui.com
 * Includes: widget.js, position.js, data.js, disable-selection.js, effect.js, effects/effect-blind.js, effects/effect-bounce.js, effects/effect-clip.js, effects/effect-drop.js, effects/effect-explode.js, effects/effect-fade.js, effects/effect-fold.js, effects/effect-highlight.js, effects/effect-puff.js, effects/effect-pulsate.js, effects/effect-scale.js, effects/effect-shake.js, effects/effect-size.js, effects/effect-slide.js, effects/effect-transfer.js, focusable.js, form-reset-mixin.js, jquery-1-7.js, keycode.js, labels.js, scroll-parent.js, tabbable.js, unique-id.js, widgets/accordion.js, widgets/autocomplete.js, widgets/button.js, widgets/checkboxradio.js, widgets/controlgroup.js, widgets/datepicker.js, widgets/dialog.js, widgets/draggable.js, widgets/droppable.js, widgets/menu.js, widgets/mouse.js, widgets/progressbar.js, widgets/resizable.js, widgets/selectable.js, widgets/selectmenu.js, widgets/slider.js, widgets/sortable.js, widgets/spinner.js, widgets/tabs.js, widgets/tooltip.js
 * Copyright jQuery Foundation and other contributors; Licensed MIT */
function($){$.ui=$.ui||{};var widgetUuid=($.ui.version="1.12.1",0),widgetSlice=Array.prototype.slice;$.cleanData=function(orig){return function(elems){var events,elem,i;for(i=0;null!=(elem=elems[i]);i++)try{events=$._data(elem,"events"),events&&events.remove&&$(elem).triggerHandler("remove")}catch(e){}orig(elems)}}($.cleanData),$.widget=function(name,base,prototype){var existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1];var fullName=namespace+"-"+name;return prototype||(prototype=base,base=$.Widget),$.isArray(prototype)&&(prototype=$.extend.apply(null,[{}].concat(prototype))),$.expr.pseudos[fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){if(!this._createWidget)return new constructor(options,element);arguments.length&&this._createWidget(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),basePrototype=new base,basePrototype.options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){if(!$.isFunction(value))return void(proxiedPrototype[prop]=value);proxiedPrototype[prop]=function(){function _super(){return base.prototype[prop].apply(this,arguments)}function _superApply(args){return base.prototype[prop].apply(this,args)}return function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}}()}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix||name:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor),constructor},$.widget.extend=function(target){for(var key,value,input=widgetSlice.call(arguments,1),inputIndex=0,inputLength=input.length;inputIndex<inputLength;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&void 0!==value&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=widgetSlice.call(arguments,1),returnValue=this;return isMethodCall?this.length||"instance"!==options?this.each(function(){var methodValue,instance=$.data(this,fullName);return"instance"===options?(returnValue=instance,!1):instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args),methodValue!==instance&&void 0!==methodValue?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0):$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'")}):returnValue=void 0:(args.length&&(options=$.widget.extend.apply(null,[options].concat(args))),this.each(function(){var instance=$.data(this,fullName);instance?(instance.option(options||{}),instance._init&&instance._init()):$.data(this,fullName,new object(options,this))})),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{classes:{},disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=widgetUuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=$(),this.hoverable=$(),this.focusable=$(),this.classesElementLookup={},element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this._create(),this.options.disabled&&this._setOptionDisabled(this.options.disabled),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:function(){return{}},_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){var that=this;this._destroy(),$.each(this.classesElementLookup,function(key,value){that._removeClass(value,key)}),this.element.off(this.eventNamespace).removeData(this.widgetFullName),this.widget().off(this.eventNamespace).prop("aria-disabled",!1),this.bindings.off(this.eventNamespace)},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},parts=key.split("."),key=parts.shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),1===arguments.length)return void 0===curOption[key]?null:curOption[key];curOption[key]=value}else{if(1===arguments.length)return void 0===this.options[key]?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return"classes"===key&&this._setOptionClasses(value),this.options[key]=value,"disabled"===key&&this._setOptionDisabled(value),this},_setOptionClasses:function(value){var classKey,elements,currentElements;for(classKey in value)currentElements=this.classesElementLookup[classKey],value[classKey]!==this.options.classes[classKey]&&currentElements&&currentElements.length&&(elements=$(currentElements.get()),this._removeClass(currentElements,classKey),elements.addClass(this._classes({element:elements,keys:classKey,classes:value,add:!0})))},_setOptionDisabled:function(value){this._toggleClass(this.widget(),this.widgetFullName+"-disabled",null,!!value),value&&(this._removeClass(this.hoverable,null,"ui-state-hover"),this._removeClass(this.focusable,null,"ui-state-focus"))},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_classes:function(options){function processClassString(classes,checkOption){var current,i;for(i=0;i<classes.length;i++)current=that.classesElementLookup[classes[i]]||$(),current=$(options.add?$.uniqueSort(current.get().concat(options.element.get())):current.not(options.element).get()),that.classesElementLookup[classes[i]]=current,full.push(classes[i]),checkOption&&options.classes[classes[i]]&&full.push(options.classes[classes[i]])}var full=[],that=this;return options=$.extend({element:this.element,classes:this.options.classes||{}},options),this._on(options.element,{"remove":"_untrackClassesElement"}),options.keys&&processClassString(options.keys.match(/\S+/g)||[],!0),options.extra&&processClassString(options.extra.match(/\S+/g)||[]),full.join(" ")},_untrackClassesElement:function(event){var that=this;$.each(that.classesElementLookup,function(key,value){-1!==$.inArray(event.target,value)&&(that.classesElementLookup[key]=$(value.not(event.target).get()))})},_removeClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!1)},_addClass:function(element,keys,extra){return this._toggleClass(element,keys,extra,!0)},_toggleClass:function(element,keys,extra,add){add="boolean"==typeof add?add:extra;var shift="string"==typeof element||null===element,options={extra:shift?keys:extra,keys:shift?element:keys,element:shift?this.element:element,add:add};return options.element.toggleClass(this._classes(options),add),this},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;"boolean"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){if(suppressDisabledCheck||!0!==instance.options.disabled&&!$(this).hasClass("ui-state-disabled"))return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^([\w:-]*)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.on(eventName,selector,handlerProxy):element.on(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.off(eventName).off(eventName),this.bindings=$(this.bindings.not(element).get()),this.focusable=$(this.focusable.not(element).get()),this.hoverable=$(this.hoverable.not(element).get())},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){this._addClass($(event.currentTarget),null,"ui-state-hover")},mouseleave:function(event){this._removeClass($(event.currentTarget),null,"ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){this._addClass($(event.currentTarget),null,"ui-state-focus")},focusout:function(event){this._removeClass($(event.currentTarget),null,"ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&!1===callback.apply(this.element[0],[event].concat(data))||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?!0===options||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{},"number"==typeof options&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}});$.widget;/*!
     * jQuery UI Position 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     * http://api.jqueryui.com/position/
     */
!function(){function getOffsets(offsets,width,height){return[parseFloat(offsets[0])*(rpercent.test(offsets[0])?width/100:1),parseFloat(offsets[1])*(rpercent.test(offsets[1])?height/100:1)]}function parseCss(element,property){return parseInt($.css(element,property),10)||0}function getDimensions(elem){var raw=elem[0];return 9===raw.nodeType?{width:elem.width(),height:elem.height(),offset:{top:0,left:0}}:$.isWindow(raw)?{width:elem.width(),height:elem.height(),offset:{top:elem.scrollTop(),left:elem.scrollLeft()}}:raw.preventDefault?{width:0,height:0,offset:{top:raw.pageY,left:raw.pageX}}:{width:elem.outerWidth(),height:elem.outerHeight(),offset:elem.offset()}}var cachedScrollbarWidth,max=Math.max,abs=Math.abs,rhorizontal=/left|center|right/,rvertical=/top|center|bottom/,roffset=/[\+\-]\d+(\.[\d]+)?%?/,rposition=/^\w+/,rpercent=/%$/,_position=$.fn.position;$.position={scrollbarWidth:function(){if(void 0!==cachedScrollbarWidth)return cachedScrollbarWidth;var w1,w2,div=$("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),innerDiv=div.children()[0];return $("body").append(div),w1=innerDiv.offsetWidth,div.css("overflow","scroll"),w2=innerDiv.offsetWidth,w1===w2&&(w2=div[0].clientWidth),div.remove(),cachedScrollbarWidth=w1-w2},getScrollInfo:function(within){var overflowX=within.isWindow||within.isDocument?"":within.element.css("overflow-x"),overflowY=within.isWindow||within.isDocument?"":within.element.css("overflow-y"),hasOverflowX="scroll"===overflowX||"auto"===overflowX&&within.width<within.element[0].scrollWidth;return{width:"scroll"===overflowY||"auto"===overflowY&&within.height<within.element[0].scrollHeight?$.position.scrollbarWidth():0,height:hasOverflowX?$.position.scrollbarWidth():0}},getWithinInfo:function(element){var withinElement=$(element||window),isWindow=$.isWindow(withinElement[0]),isDocument=!!withinElement[0]&&9===withinElement[0].nodeType;return{element:withinElement,isWindow:isWindow,isDocument:isDocument,offset:isWindow||isDocument?{left:0,top:0}:$(element).offset(),scrollLeft:withinElement.scrollLeft(),scrollTop:withinElement.scrollTop(),width:withinElement.outerWidth(),height:withinElement.outerHeight()}}},$.fn.position=function(options){if(!options||!options.of)return _position.apply(this,arguments);options=$.extend({},options);var atOffset,targetWidth,targetHeight,targetOffset,basePosition,dimensions,target=$(options.of),within=$.position.getWithinInfo(options.within),scrollInfo=$.position.getScrollInfo(within),collision=(options.collision||"flip").split(" "),offsets={};return dimensions=getDimensions(target),target[0].preventDefault&&(options.at="left top"),targetWidth=dimensions.width,targetHeight=dimensions.height,targetOffset=dimensions.offset,basePosition=$.extend({},targetOffset),$.each(["my","at"],function(){var horizontalOffset,verticalOffset,pos=(options[this]||"").split(" ");1===pos.length&&(pos=rhorizontal.test(pos[0])?pos.concat(["center"]):rvertical.test(pos[0])?["center"].concat(pos):["center","center"]),pos[0]=rhorizontal.test(pos[0])?pos[0]:"center",pos[1]=rvertical.test(pos[1])?pos[1]:"center",horizontalOffset=roffset.exec(pos[0]),verticalOffset=roffset.exec(pos[1]),offsets[this]=[horizontalOffset?horizontalOffset[0]:0,verticalOffset?verticalOffset[0]:0],options[this]=[rposition.exec(pos[0])[0],rposition.exec(pos[1])[0]]}),1===collision.length&&(collision[1]=collision[0]),"right"===options.at[0]?basePosition.left+=targetWidth:"center"===options.at[0]&&(basePosition.left+=targetWidth/2),"bottom"===options.at[1]?basePosition.top+=targetHeight:"center"===options.at[1]&&(basePosition.top+=targetHeight/2),atOffset=getOffsets(offsets.at,targetWidth,targetHeight),basePosition.left+=atOffset[0],basePosition.top+=atOffset[1],this.each(function(){var collisionPosition,using,elem=$(this),elemWidth=elem.outerWidth(),elemHeight=elem.outerHeight(),marginLeft=parseCss(this,"marginLeft"),marginTop=parseCss(this,"marginTop"),collisionWidth=elemWidth+marginLeft+parseCss(this,"marginRight")+scrollInfo.width,collisionHeight=elemHeight+marginTop+parseCss(this,"marginBottom")+scrollInfo.height,position=$.extend({},basePosition),myOffset=getOffsets(offsets.my,elem.outerWidth(),elem.outerHeight());"right"===options.my[0]?position.left-=elemWidth:"center"===options.my[0]&&(position.left-=elemWidth/2),"bottom"===options.my[1]?position.top-=elemHeight:"center"===options.my[1]&&(position.top-=elemHeight/2),position.left+=myOffset[0],position.top+=myOffset[1],collisionPosition={marginLeft:marginLeft,marginTop:marginTop},$.each(["left","top"],function(i,dir){$.ui.position[collision[i]]&&$.ui.position[collision[i]][dir](position,{targetWidth:targetWidth,targetHeight:targetHeight,elemWidth:elemWidth,elemHeight:elemHeight,collisionPosition:collisionPosition,collisionWidth:collisionWidth,collisionHeight:collisionHeight,offset:[atOffset[0]+myOffset[0],atOffset[1]+myOffset[1]],my:options.my,at:options.at,within:within,elem:elem})}),options.using&&(using=function(props){var left=targetOffset.left-position.left,right=left+targetWidth-elemWidth,top=targetOffset.top-position.top,bottom=top+targetHeight-elemHeight,feedback={target:{element:target,left:targetOffset.left,top:targetOffset.top,width:targetWidth,height:targetHeight},element:{element:elem,left:position.left,top:position.top,width:elemWidth,height:elemHeight},horizontal:right<0?"left":left>0?"right":"center",vertical:bottom<0?"top":top>0?"bottom":"middle"};targetWidth<elemWidth&&abs(left+right)<targetWidth&&(feedback.horizontal="center"),targetHeight<elemHeight&&abs(top+bottom)<targetHeight&&(feedback.vertical="middle"),max(abs(left),abs(right))>max(abs(top),abs(bottom))?feedback.important="horizontal":feedback.important="vertical",options.using.call(this,props,feedback)}),elem.offset($.extend(position,{using:using}))})},$.ui.position={fit:{left:function(position,data){var newOverRight,within=data.within,withinOffset=within.isWindow?within.scrollLeft:within.offset.left,outerWidth=within.width,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=withinOffset-collisionPosLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-withinOffset;data.collisionWidth>outerWidth?overLeft>0&&overRight<=0?(newOverRight=position.left+overLeft+data.collisionWidth-outerWidth-withinOffset,position.left+=overLeft-newOverRight):position.left=overRight>0&&overLeft<=0?withinOffset:overLeft>overRight?withinOffset+outerWidth-data.collisionWidth:withinOffset:overLeft>0?position.left+=overLeft:overRight>0?position.left-=overRight:position.left=max(position.left-collisionPosLeft,position.left)},top:function(position,data){var newOverBottom,within=data.within,withinOffset=within.isWindow?within.scrollTop:within.offset.top,outerHeight=data.within.height,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=withinOffset-collisionPosTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-withinOffset;data.collisionHeight>outerHeight?overTop>0&&overBottom<=0?(newOverBottom=position.top+overTop+data.collisionHeight-outerHeight-withinOffset,position.top+=overTop-newOverBottom):position.top=overBottom>0&&overTop<=0?withinOffset:overTop>overBottom?withinOffset+outerHeight-data.collisionHeight:withinOffset:overTop>0?position.top+=overTop:overBottom>0?position.top-=overBottom:position.top=max(position.top-collisionPosTop,position.top)}},flip:{left:function(position,data){var newOverRight,newOverLeft,within=data.within,withinOffset=within.offset.left+within.scrollLeft,outerWidth=within.width,offsetLeft=within.isWindow?within.scrollLeft:within.offset.left,collisionPosLeft=position.left-data.collisionPosition.marginLeft,overLeft=collisionPosLeft-offsetLeft,overRight=collisionPosLeft+data.collisionWidth-outerWidth-offsetLeft,myOffset="left"===data.my[0]?-data.elemWidth:"right"===data.my[0]?data.elemWidth:0,atOffset="left"===data.at[0]?data.targetWidth:"right"===data.at[0]?-data.targetWidth:0,offset=-2*data.offset[0];overLeft<0?((newOverRight=position.left+myOffset+atOffset+offset+data.collisionWidth-outerWidth-withinOffset)<0||newOverRight<abs(overLeft))&&(position.left+=myOffset+atOffset+offset):overRight>0&&((newOverLeft=position.left-data.collisionPosition.marginLeft+myOffset+atOffset+offset-offsetLeft)>0||abs(newOverLeft)<overRight)&&(position.left+=myOffset+atOffset+offset)},top:function(position,data){var newOverTop,newOverBottom,within=data.within,withinOffset=within.offset.top+within.scrollTop,outerHeight=within.height,offsetTop=within.isWindow?within.scrollTop:within.offset.top,collisionPosTop=position.top-data.collisionPosition.marginTop,overTop=collisionPosTop-offsetTop,overBottom=collisionPosTop+data.collisionHeight-outerHeight-offsetTop,top="top"===data.my[1],myOffset=top?-data.elemHeight:"bottom"===data.my[1]?data.elemHeight:0,atOffset="top"===data.at[1]?data.targetHeight:"bottom"===data.at[1]?-data.targetHeight:0,offset=-2*data.offset[1];overTop<0?((newOverBottom=position.top+myOffset+atOffset+offset+data.collisionHeight-outerHeight-withinOffset)<0||newOverBottom<abs(overTop))&&(position.top+=myOffset+atOffset+offset):overBottom>0&&((newOverTop=position.top-data.collisionPosition.marginTop+myOffset+atOffset+offset-offsetTop)>0||abs(newOverTop)<overBottom)&&(position.top+=myOffset+atOffset+offset)}},flipfit:{left:function(){$.ui.position.flip.left.apply(this,arguments),$.ui.position.fit.left.apply(this,arguments)},top:function(){$.ui.position.flip.top.apply(this,arguments),$.ui.position.fit.top.apply(this,arguments)}}}}($jQ);$.ui.position;/*!
     * jQuery UI Support for jQuery core 1.7.x 1.12.1
     * http://jqueryui.com
     *
     * Copyright jQuery Foundation and other contributors
     * Released under the MIT license.
     * http://jquery.org/license
     *
     */
"1.7"===$.fn.jquery.substring(0,3)&&($.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return void 0===size?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))});var mouseHandled=($.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),!1);$(document).on("mouseup",function(){mouseHandled=!1});$.widget("ui.mouse",{version:"1.12.1",options:{cancel:"input, textarea, button, select, option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.on("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).on("click."+this.widgetName,function(event){if(!0===$.data(event.target,that.widgetName+".preventClickEvent"))return $.removeData(event.target,that.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.off("."+this.widgetName),this._mouseMoveDelegate&&this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel=!("string"!=typeof this.options.cancel||!event.target.nodeName)&&$(event.target).closest(this.options.cancel).length;return!(btnIsLeft&&!elIsCancel&&this._mouseCapture(event))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(event),!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},this.document.on("mousemove."+this.widgetName,this._mouseMoveDelegate).on("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0))}},_mouseMove:function(event){if(this._mouseMoved){if($.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button)return this._mouseUp(event);if(!event.which)if(event.originalEvent.altKey||event.originalEvent.ctrlKey||event.originalEvent.metaKey||event.originalEvent.shiftKey)this.ignoreMissingWhich=!0;else if(!this.ignoreMissingWhich)return this._mouseUp(event)}return(event.which||event.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,event),this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted)},_mouseUp:function(event){this.document.off("mousemove."+this.widgetName,this._mouseMoveDelegate).off("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),this._mouseDelayTimer&&(clearTimeout(this._mouseDelayTimer),delete this._mouseDelayTimer),this.ignoreMissingWhich=!1,mouseHandled=!1,event.preventDefault()},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),$.ui.plugin={add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args,allowDisconnected){var i,set=instance.plugins[name];if(set&&(allowDisconnected||instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType))for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},$.ui.safeBlur=function(element){element&&"body"!==element.nodeName.toLowerCase()&&$(element).trigger("blur")},$.widget("ui.slider",$.ui.mouse,{version:"1.12.1",widgetEventPrefix:"slide",options:{animate:!1,classes:{"ui-slider":"ui-corner-all","ui-slider-handle":"ui-corner-all","ui-slider-range":"ui-corner-all ui-widget-header"},distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this._addClass("ui-slider ui-slider-"+this.orientation,"ui-widget ui-widget-content"),this._refresh(),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var i,handleCount,options=this.options,existingHandles=this.element.find(".ui-slider-handle"),handles=[];for(handleCount=options.values&&options.values.length||1,existingHandles.length>handleCount&&(existingHandles.slice(handleCount).remove(),existingHandles=existingHandles.slice(0,handleCount)),i=existingHandles.length;i<handleCount;i++)handles.push("<span tabindex='0'></span>");this.handles=existingHandles.add($(handles.join("")).appendTo(this.element)),this._addClass(this.handles,"ui-slider-handle","ui-state-default"),this.handle=this.handles.eq(0),this.handles.each(function(i){$(this).data("ui-slider-handle-index",i).attr("tabIndex",0)})},_createRange:function(){var options=this.options;options.range?(!0===options.range&&(options.values?options.values.length&&2!==options.values.length?options.values=[options.values[0],options.values[0]]:$.isArray(options.values)&&(options.values=options.values.slice(0)):options.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?(this._removeClass(this.range,"ui-slider-range-min ui-slider-range-max"),this.range.css({"left":"","bottom":""})):(this.range=$("<div>").appendTo(this.element),this._addClass(this.range,"ui-slider-range")),"min"!==options.range&&"max"!==options.range||this._addClass(this.range,"ui-slider-range-"+options.range)):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this._mouseDestroy()},_mouseCapture:function(event){var position,normValue,distance,closestHandle,index,offset,mouseOverHandle,that=this,o=this.options;return!o.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position),distance=this._valueMax()-this._valueMin()+1,this.handles.each(function(i){var thisDistance=Math.abs(normValue-that.values(i));(distance>thisDistance||distance===thisDistance&&(i===that._lastChangedValue||that.values(i)===o.min))&&(distance=thisDistance,closestHandle=$(this),index=i)}),!1!==this._start(event,index)&&(this._mouseSliding=!0,this._handleIndex=index,this._addClass(closestHandle,null,"ui-state-active"),closestHandle.trigger("focus"),offset=closestHandle.offset(),mouseOverHandle=!$(event.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=mouseOverHandle?{left:0,top:0}:{left:event.pageX-offset.left-closestHandle.width()/2,top:event.pageY-offset.top-closestHandle.height()/2-(parseInt(closestHandle.css("borderTopWidth"),10)||0)-(parseInt(closestHandle.css("borderBottomWidth"),10)||0)+(parseInt(closestHandle.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(event,index,normValue),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(event){var position={x:event.pageX,y:event.pageY},normValue=this._normValueFromMouse(position);return this._slide(event,this._handleIndex,normValue),!1},_mouseStop:function(event){return this._removeClass(this.handles,null,"ui-state-active"),this._mouseSliding=!1,this._stop(event,this._handleIndex),this._change(event,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(position){var pixelTotal,pixelMouse,percentMouse,valueTotal,valueMouse;return"horizontal"===this.orientation?(pixelTotal=this.elementSize.width,pixelMouse=position.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(pixelTotal=this.elementSize.height,pixelMouse=position.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),percentMouse=pixelMouse/pixelTotal,percentMouse>1&&(percentMouse=1),percentMouse<0&&(percentMouse=0),"vertical"===this.orientation&&(percentMouse=1-percentMouse),valueTotal=this._valueMax()-this._valueMin(),valueMouse=this._valueMin()+percentMouse*valueTotal,this._trimAlignValue(valueMouse)},_uiHash:function(index,value,values){var uiHash={handle:this.handles[index],handleIndex:index,value:void 0!==value?value:this.value()};return this._hasMultipleValues()&&(uiHash.value=void 0!==value?value:this.values(index),uiHash.values=values||this.values()),uiHash},_hasMultipleValues:function(){return this.options.values&&this.options.values.length},_start:function(event,index){return this._trigger("start",event,this._uiHash(index))},_slide:function(event,index,newVal){var otherVal,currentValue=this.value(),newValues=this.values();this._hasMultipleValues()&&(otherVal=this.values(index?0:1),currentValue=this.values(index),2===this.options.values.length&&!0===this.options.range&&(newVal=0===index?Math.min(otherVal,newVal):Math.max(otherVal,newVal)),newValues[index]=newVal),newVal!==currentValue&&!1!==this._trigger("slide",event,this._uiHash(index,newVal,newValues))&&(this._hasMultipleValues()?this.values(index,newVal):this.value(newVal))},_stop:function(event,index){this._trigger("stop",event,this._uiHash(index))},_change:function(event,index){this._keySliding||this._mouseSliding||(this._lastChangedValue=index,this._trigger("change",event,this._uiHash(index)))},value:function(newValue){return arguments.length?(this.options.value=this._trimAlignValue(newValue),this._refreshValue(),void this._change(null,0)):this._value()},values:function(index,newValue){var vals,newValues,i;if(arguments.length>1)return this.options.values[index]=this._trimAlignValue(newValue),this._refreshValue(),void this._change(null,index);if(!arguments.length)return this._values();if(!$.isArray(arguments[0]))return this._hasMultipleValues()?this._values(index):this.value();for(vals=this.options.values,newValues=arguments[0],i=0;i<vals.length;i+=1)vals[i]=this._trimAlignValue(newValues[i]),this._change(null,i);this._refreshValue()},_setOption:function(key,value){var i,valsLength=0;switch("range"===key&&!0===this.options.range&&("min"===value?(this.options.value=this._values(0),this.options.values=null):"max"===value&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),$.isArray(this.options.values)&&(valsLength=this.options.values.length),this._super(key,value),key){case"orientation":this._detectOrientation(),this._removeClass("ui-slider-horizontal ui-slider-vertical")._addClass("ui-slider-"+this.orientation),this._refreshValue(),this.options.range&&this._refreshRange(value),this.handles.css("horizontal"===value?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),i=valsLength-1;i>=0;i--)this._change(null,i);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_setOptionDisabled:function(value){this._super(value),this._toggleClass(null,"ui-state-disabled",!!value)},_value:function(){var val=this.options.value;return val=this._trimAlignValue(val)},_values:function(index){var val,vals,i;if(arguments.length)return val=this.options.values[index],val=this._trimAlignValue(val);if(this._hasMultipleValues()){for(vals=this.options.values.slice(),i=0;i<vals.length;i+=1)vals[i]=this._trimAlignValue(vals[i]);return vals}return[]},_trimAlignValue:function(val){if(val<=this._valueMin())return this._valueMin();if(val>=this._valueMax())return this._valueMax();var step=this.options.step>0?this.options.step:1,valModStep=(val-this._valueMin())%step,alignValue=val-valModStep;return 2*Math.abs(valModStep)>=step&&(alignValue+=valModStep>0?step:-step),parseFloat(alignValue.toFixed(5))},_calculateNewMax:function(){var max=Number(this.options.max),min=Number(this._valueMin()),step=this.options.step;max=Math.round((max-min)/step)*step+min,max>this.options.max&&(max-=step),this.max=parseFloat(max.toFixed(this._precision()))},_precision:function(){var precision=this._precisionOf(this.options.step);return null!==this.options.min&&(precision=Math.max(precision,this._precisionOf(this.options.min))),precision},_precisionOf:function(num){var str=num.toString(),decimal=str.indexOf(".");return-1===decimal?0:str.length-decimal-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshRange:function(orientation){"vertical"===orientation&&this.range.css({"width":"","left":""}),"horizontal"===orientation&&this.range.css({"height":"","bottom":""})},_refreshValue:function(){var lastValPercent,valPercent,value,valueMin,valueMax,oRange=this.options.range,o=this.options,that=this,animate=!this._animateOff&&o.animate,_set={};this._hasMultipleValues()?this.handles.each(function(i){valPercent=(that.values(i)-that._valueMin())/(that._valueMax()-that._valueMin())*100,_set["horizontal"===that.orientation?"left":"bottom"]=valPercent+"%",$(this).stop(1,1)[animate?"animate":"css"](_set,o.animate),!0===that.options.range&&("horizontal"===that.orientation?(0===i&&that.range.stop(1,1)[animate?"animate":"css"]({left:valPercent+"%"},o.animate),1===i&&that.range[animate?"animate":"css"]({width:valPercent-lastValPercent+"%"},{queue:!1,duration:o.animate})):(0===i&&that.range.stop(1,1)[animate?"animate":"css"]({bottom:valPercent+"%"},o.animate),1===i&&that.range[animate?"animate":"css"]({height:valPercent-lastValPercent+"%"},{queue:!1,duration:o.animate}))),lastValPercent=valPercent}):(value=this.value(),valueMin=this._valueMin(),valueMax=this._valueMax(),valPercent=valueMax!==valueMin?(value-valueMin)/(valueMax-valueMin)*100:0,_set["horizontal"===this.orientation?"left":"bottom"]=valPercent+"%",this.handle.stop(1,1)[animate?"animate":"css"](_set,o.animate),"min"===oRange&&"horizontal"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({width:valPercent+"%"},o.animate),"max"===oRange&&"horizontal"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({width:100-valPercent+"%"},o.animate),"min"===oRange&&"vertical"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({height:valPercent+"%"},o.animate),"max"===oRange&&"vertical"===this.orientation&&this.range.stop(1,1)[animate?"animate":"css"]({height:100-valPercent+"%"},o.animate))},_handleEvents:{keydown:function(event){var curVal,newVal,step,index=$(event.target).data("ui-slider-handle-index");switch(event.keyCode){case $.ui.keyCode.HOME:case $.ui.keyCode.END:case $.ui.keyCode.PAGE_UP:case $.ui.keyCode.PAGE_DOWN:case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(event.preventDefault(),!this._keySliding&&(this._keySliding=!0,this._addClass($(event.target),null,"ui-state-active"),!1===this._start(event,index)))return}switch(step=this.options.step,curVal=newVal=this._hasMultipleValues()?this.values(index):this.value(),event.keyCode){case $.ui.keyCode.HOME:newVal=this._valueMin();break;case $.ui.keyCode.END:newVal=this._valueMax();break;case $.ui.keyCode.PAGE_UP:newVal=this._trimAlignValue(curVal+(this._valueMax()-this._valueMin())/this.numPages);break;case $.ui.keyCode.PAGE_DOWN:newVal=this._trimAlignValue(curVal-(this._valueMax()-this._valueMin())/this.numPages);break;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:if(curVal===this._valueMax())return;newVal=this._trimAlignValue(curVal+step);break;case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:if(curVal===this._valueMin())return;newVal=this._trimAlignValue(curVal-step)}this._slide(event,index,newVal)},keyup:function(event){var index=$(event.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(event,index),this._change(event,index),this._removeClass($(event.target),null,"ui-state-active"))}}});/*!
     * jQuery blockUI plugin
     * Version 2.70.0-2014.11.23
     * Requires jQuery v1.7 or later
     *
     * Examples at: http://malsup.com/jquery/block/
     * Copyright (c) 2007-2013 M. Alsup
     * Dual licensed under the MIT and GPL licenses:
     * http://www.opensource.org/licenses/mit-license.php
     * http://www.gnu.org/licenses/gpl.html
     *
     * Thanks to Amir-Hossein Sobhi for some excellent contributions!
     */
!function(){"use strict";!function($){function install(el,opts){var css,themedCSS,full=el==window,msg=opts&&void 0!==opts.message?opts.message:void 0;if(opts=$.extend({},$.blockUI.defaults,opts||{}),!opts.ignoreIfBlocked||!$(el).data("blockUI.isBlocked")){if(opts.overlayCSS=$.extend({},$.blockUI.defaults.overlayCSS,opts.overlayCSS||{}),css=$.extend({},$.blockUI.defaults.css,opts.css||{}),opts.onOverlayClick&&(opts.overlayCSS.cursor="pointer"),themedCSS=$.extend({},$.blockUI.defaults.themedCSS,opts.themedCSS||{}),msg=void 0===msg?opts.message:msg,full&&pageBlock&&remove(window,{fadeOut:0}),msg&&"string"!=typeof msg&&(msg.parentNode||msg.jquery)){var node=msg.jquery?msg[0]:msg,data={};$(el).data("blockUI.history",data),data.el=node,data.parent=node.parentNode,data.display=node.style.display,data.position=node.style.position,data.parent&&data.parent.removeChild(node)}$(el).data("blockUI.onUnblock",opts.onUnblock);var lyr1,lyr2,lyr3,s,z=opts.baseZ;lyr1=$(msie||opts.forceIframe?'<iframe class="blockUI" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+opts.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),lyr2=$(opts.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+z+++';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+z+++';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),opts.theme&&full?(s='<div class="blockUI '+opts.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:fixed">',opts.title&&(s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),s+='<div class="ui-widget-content ui-dialog-content"></div>',s+="</div>"):opts.theme?(s='<div class="blockUI '+opts.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(z+10)+';display:none;position:absolute">',opts.title&&(s+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(opts.title||"&nbsp;")+"</div>"),s+='<div class="ui-widget-content ui-dialog-content"></div>',s+="</div>"):s=full?'<div class="blockUI '+opts.blockMsgClass+' blockPage" style="z-index:'+(z+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+opts.blockMsgClass+' blockElement" style="z-index:'+(z+10)+';display:none;position:absolute"></div>',lyr3=$(s),msg&&(opts.theme?(lyr3.css(themedCSS),lyr3.addClass("ui-widget-content")):lyr3.css(css)),opts.theme||lyr2.css(opts.overlayCSS),lyr2.css("position",full?"fixed":"absolute"),(msie||opts.forceIframe)&&lyr1.css("opacity",0);var layers=[lyr1,lyr2,lyr3],$par=$(full?"body":el);$.each(layers,function(){this.appendTo($par)}),opts.theme&&opts.draggable&&$.fn.draggable&&lyr3.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var expr=setExpr&&(!$.support.boxModel||$("object,embed",full?null:el).length>0);if(ie6||expr){if(full&&opts.allowBodyStretch&&$.support.boxModel&&$("html,body").css("height","100%"),(ie6||!$.support.boxModel)&&!full)var t=sz(el,"borderTopWidth"),l=sz(el,"borderLeftWidth"),fixT=t?"(0 - "+t+")":0,fixL=l?"(0 - "+l+")":0;$.each(layers,function(i,o){var s=o[0].style;if(s.position="absolute",i<2)full?s.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+opts.quirksmodeOffsetHack+') + "px"'):s.setExpression("height",'this.parentNode.offsetHeight + "px"'),full?s.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):s.setExpression("width",'this.parentNode.offsetWidth + "px"'),fixL&&s.setExpression("left",fixL),fixT&&s.setExpression("top",fixT);else if(opts.centerY)full&&s.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),s.marginTop=0;else if(!opts.centerY&&full){var top=opts.css&&opts.css.top?parseInt(opts.css.top,10):0,expression="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+top+') + "px"';s.setExpression("top",expression)}})}if(msg&&(opts.theme?lyr3.find(".ui-widget-content").append(msg):lyr3.append(msg),(msg.jquery||msg.nodeType)&&$(msg).show()),(msie||opts.forceIframe)&&opts.showOverlay&&lyr1.show(),opts.fadeIn){var cb=opts.onBlock?opts.onBlock:noOp,cb1=opts.showOverlay&&!msg?cb:noOp,cb2=msg?cb:noOp;opts.showOverlay&&lyr2._fadeIn(opts.fadeIn,cb1),msg&&lyr3._fadeIn(opts.fadeIn,cb2)}else opts.showOverlay&&lyr2.show(),msg&&lyr3.show(),opts.onBlock&&opts.onBlock.on(lyr3)();if(bind(1,el,opts),full?(pageBlock=lyr3[0],pageBlockEls=$(opts.focusableElements,pageBlock),opts.focusInput&&setTimeout(focus,20)):center(lyr3[0],opts.centerX,opts.centerY),opts.timeout){var to=setTimeout(function(){full?$.unblockUI(opts):$(el).unblock(opts)},opts.timeout);$(el).data("blockUI.timeout",to)}}}function remove(el,opts){var count,full=el==window,$el=$(el),data=$el.data("blockUI.history"),to=$el.data("blockUI.timeout");to&&(clearTimeout(to),$el.removeData("blockUI.timeout")),opts=$.extend({},$.blockUI.defaults,opts||{}),bind(0,el,opts),null===opts.onUnblock&&(opts.onUnblock=$el.data("blockUI.onUnblock"),$el.removeData("blockUI.onUnblock"));var els;els=full?$("body").children().filter(".blockUI").add("body > .blockUI"):$el.find(">.blockUI"),opts.cursorReset&&(els.length>1&&(els[1].style.cursor=opts.cursorReset),els.length>2&&(els[2].style.cursor=opts.cursorReset)),full&&(pageBlock=pageBlockEls=null),opts.fadeOut?(count=els.length,els.stop().fadeOut(opts.fadeOut,function(){0==--count&&reset(els,data,opts,el)})):reset(els,data,opts,el)}function reset(els,data,opts,el){var $el=$(el);if(!$el.data("blockUI.isBlocked")){els.each(function(i,o){this.parentNode&&this.parentNode.removeChild(this)}),data&&data.el&&(data.el.style.display=data.display,data.el.style.position=data.position,data.el.style.cursor="default",data.parent&&data.parent.appendChild(data.el),$el.removeData("blockUI.history")),$el.data("blockUI.static")&&$el.css("position","static"),"function"==typeof opts.onUnblock&&opts.onUnblock(el,opts);var body=$(document.body),w=body.width(),cssW=body[0].style.width;body.width(w-1).width(w),body[0].style.width=cssW}}function bind(b,el,opts){var full=el==window,$el=$(el);if((b||(!full||pageBlock)&&(full||$el.data("blockUI.isBlocked")))&&($el.data("blockUI.isBlocked",b),full&&opts.bindEvents&&(!b||opts.showOverlay))){var events="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";b?$(document).on(events,opts,handler):$(document).off(events,handler)}}function handler(e){if("keydown"===e.type&&e.keyCode&&9==e.keyCode&&pageBlock&&e.data.constrainTabKey){var els=pageBlockEls,fwd=!e.shiftKey&&e.target===els[els.length-1],back=e.shiftKey&&e.target===els[0];if(fwd||back)return setTimeout(function(){focus(back)},10),!1}var opts=e.data,target=$(e.target);return target.hasClass("blockOverlay")&&opts.onOverlayClick&&opts.onOverlayClick(e),target.parents("div."+opts.blockMsgClass).length>0||0===target.parents().children().filter("div.blockUI").length}function focus(back){if(pageBlockEls){var e=pageBlockEls[!0===back?pageBlockEls.length-1:0];e&&e.focus()}}function center(el,x,y){var p=el.parentNode,s=el.style,l=(p.offsetWidth-el.offsetWidth)/2-sz(p,"borderLeftWidth"),t=(p.offsetHeight-el.offsetHeight)/2-sz(p,"borderTopWidth");x&&(s.left=l>0?l+"px":"0"),y&&(s.top=t>0?t+"px":"0")}function sz(el,p){return parseInt($.css(el,p),10)||0}$.fn._fadeIn=$.fn.fadeIn;var noOp=$.noop||function(){},msie=/MSIE/.test(navigator.userAgent),ie6=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),setExpr=(document.documentMode,$.isFunction(document.createElement("div").style.setExpression));$.blockUI=function(opts){install(window,opts)},$.unblockUI=function(opts){remove(window,opts)},$.growlUI=function(title,message,timeout,onClose){var $m=$('<div class="growlUI"></div>');title&&$m.append("<h1>"+title+"</h1>"),message&&$m.append("<h2>"+message+"</h2>"),void 0===timeout&&(timeout=3e3);var callBlock=function(opts){opts=opts||{},$.blockUI({message:$m,fadeIn:void 0!==opts.fadeIn?opts.fadeIn:700,fadeOut:void 0!==opts.fadeOut?opts.fadeOut:1e3,timeout:void 0!==opts.timeout?opts.timeout:timeout,centerY:!1,showOverlay:!1,onUnblock:onClose,css:$.blockUI.defaults.growlCSS})};callBlock(),$m.css("opacity"),$m.mouseover(function(){callBlock({fadeIn:0,timeout:3e4});var displayBlock=$(".blockMsg");displayBlock.stop(),displayBlock.fadeTo(300,1)}).mouseout(function(){$(".blockMsg").fadeOut(1e3)})},$.fn.block=function(opts){if(this[0]===window)return $.blockUI(opts),this;var fullOpts=$.extend({},$.blockUI.defaults,opts||{});return this.each(function(){var $el=$(this);fullOpts.ignoreIfBlocked&&$el.data("blockUI.isBlocked")||$el.unblock({fadeOut:0})}),this.each(function(){"static"==$.css(this,"position")&&(this.style.position="relative",$(this).data("blockUI.static",!0)),this.style.zoom=1,install(this,opts)})},$.fn.unblock=function(opts){return this[0]===window?($.unblockUI(opts),this):this.each(function(){remove(this,opts)})},$.blockUI.version=2.7,$.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var pageBlock=null,pageBlockEls=[]}($jQ)}($jQ)}($jQ),/*!
 * jQuery UI Touch Punch 0.2.3
 *
 * Copyright 2011–2014, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
function($){function simulateMouseEvent(event,simulatedType){if(!(event.originalEvent.touches.length>1)){event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent)}}if($.support.touch="ontouchend"in document,$.support.touch){var touchHandled,mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit,_mouseDestroy=mouseProto._mouseDestroy;mouseProto._touchStart=function(event){var self=this;!touchHandled&&self._mouseCapture(event.originalEvent.changedTouches[0])&&(touchHandled=!0,self._touchMoved=!1,simulateMouseEvent(event,"mouseover"),simulateMouseEvent(event,"mousemove"),simulateMouseEvent(event,"mousedown"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,"mousemove"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,"mouseup"),simulateMouseEvent(event,"mouseout"),this._touchMoved||simulateMouseEvent(event,"click"),touchHandled=!1)},mouseProto._mouseInit=function(){var self=this;self.element.on("touchstart",$.proxy(self,"_touchStart")),self.element.on("touchmove",$.proxy(self,"_touchMove")),self.element.on("touchend",$.proxy(self,"_touchEnd")),_mouseInit.call(self)},mouseProto._mouseDestroy=function(){var self=this;self.element.unbind({touchstart:$.proxy(self,"_touchStart"),touchmove:$.proxy(self,"_touchMove"),touchend:$.proxy(self,"_touchEnd")}),_mouseDestroy.call(self)}}}($jQ),websight.sooqr.ResultsPanel=function(controllerInstance,parameters){this._name="ResultsPanel",this.controllerInstance=controllerInstance,this.container=this.controllerInstance.container,this.resultContainer=null,this.parameters=parameters,this.persistentParameters={sortBy:""},this.showMoreButton=null,this.moreResultsLoader=null,this.resultOffset=0,this.lastResultParameters={},this.lastSuccessfulResultParameters={},this.lastScrollPosition=null,this.addResultsOnScroll="addResultsOnScroll"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.addResultsOnScroll,this.setPersistentParameters=function(parameters){var options=["sortBy","viewType"];for(k in options)options[k]in parameters&&(this.persistentParameters[options[k]]=parameters[options[k]])},this.updateResults=function(parameters){if(this.toggleMoreResultsLoader(!1),this.lastResultParameters=parameters,this.resultContainer=null,parameters.numberOfResults&&(this.lastSuccessfulResultParameters=parameters),null!=parameters.resultsPanel.resultOffset&&parameters.resultsPanel.resultOffset>0){var newResultHtml=$jQ('<div class="sooqrSearchResults">'+parameters.resultsPanel.html+"</div>"),newResults=$jQ("div.results, .sqr-results",newResultHtml[0]);this.addClickEvents(newResults.children(),parameters.resultsPanel),this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),this.resultContainer.find("div.results, .sqr-results").append(newResults.children())}else{this.resultOffset=0,this.resultContainer=$jQ("div.sooqrSearchResultsContainer div.sooqrSearchResults",this.container),controllerInstance.needResultsRender(parameters)&&this.resultContainer.html(parameters.resultsPanel.html),$jQ("div.options div.views ul li, div.sqr-options div.sqr-views ul li",this.resultContainer).on("click",$jQ.proxy(this.handleViewClick,this)),"disableCustomSort"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.disableCustomSort||$jQ('div.sort select[name="sortby"], div.sqr-sort select[name="sortby"]',this.container).selectbox({effect:"fade",onOpen:function(inst){$jQ("#"+inst.settings.classHolder+"_"+inst.uid).toggleClass(inst.settings.classHolder+"Open",inst.isOpen);var activeOption=$jQ("#"+inst.settings.classOptions+"_"+inst.uid).find('a[rel="'+inst.input.val()+'"]').parent();activeOption.siblings().removeClass("sbActive"),activeOption.addClass("sbActive")},onClose:function(inst){$jQ("#"+inst.settings.classHolder+"_"+inst.uid).toggleClass(inst.settings.classHolder+"Open",inst.isOpen)},onChange:$jQ.proxy(function(val,inst){$jQ.proxy(this.handleSortChange(val),this)},this)}),$jQ('ul[class="sortby"] a, ul[class="sqr-sortby"] a',this.container).on("click",$jQ.proxy(this.handleSortClick,this));const controllerInstanceContainer=$jQ(this.controllerInstance.container),elementIsInBody=document.body.contains(controllerInstanceContainer[0]),elementIsVisible=controllerInstanceContainer.is(":visible");if(elementIsInBody&&elementIsVisible){const elementLowerThanTop=controllerInstanceContainer.position().top<$jQ(document).scrollTop(),canScroll=elementIsVisible&&elementLowerThanTop,autoScrollEnabled=!("disable_auto_scroll_to_top"in this.controllerInstance.indexSettings.view),disableAutoScrollToTopIsZero=0===this.controllerInstance.indexSettings.view.disable_auto_scroll_to_top;(autoScrollEnabled||disableAutoScrollToTopIsZero)&&canScroll&&$jQ("html, body").animate({scrollTop:$jQ(this.controllerInstance.container).position().top},"fast")}parameters.numberOfResults>0&&(this.addClickEvents($jQ("div .results div.resultItem",this.resultsContainer),parameters.resultsPanel),this.addClickEvents($jQ("div .sqr-results .sqr-resultItem",this.resultsContainer),parameters.resultsPanel))}"headerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchHeader").html(parameters.resultsPanel.headerHtml).show():this.container.find("div.sooqrSearchHeader").hide(),"footerHtml"in parameters.resultsPanel?this.container.find("div.sooqrSearchFooter").html(parameters.resultsPanel.footerHtml).show():this.container.find("div.sooqrSearchFooter").hide(),$jQ(".closeButton, .sqr-closeButton, .sqr-mobile-bottom-close-button",this.container).on("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),$jQ(".sqr-mobile-bottom-up-button",this.container).on("click",function(){$jQ("html, body").animate({scrollTop:0},1e3)}),this.toggleShowMoreButton(parameters.resultsPanel.resultsInResponse+parameters.resultsPanel.resultOffset<parameters.numberOfResults,parameters.numberOfResults,parameters.numberOfResults),parameters.numberOfResults>0&&this.updateResultsCounter(parameters.numberOfResults),this.updateResultNotifier(),this.addResultsOnScroll&&$jQ(window).off("scroll",this.moreResultsScrollHandler).on("scroll",this.moreResultsScrollHandler),this.controllerInstance.indexSettings.view.cssVersion>=4&&($jQ(window).off("scroll",this.optionBarScrollHandler).on("scroll",this.optionBarScrollHandler),this.handleOptionBarWindowScroll()),"mobileBottomButton"in this.controllerInstance.indexSettings.view&&1!=this.controllerInstance.indexSettings.view.mobileBottomButton||($jQ(window).off("scroll",this.mobileBottomButtonsScrollHandler).on("scroll",this.mobileBottomButtonsScrollHandler),this.handleMobileBottomButtonsWindowScroll())},this.handleViewClick=function(event){var viewObject=$jQ(event.target),currentView=$jQ("li.active, li.sqr-active",viewObject.closest("ul"));currentView.length&&($jQ("div.results, .sqr-results",this.resultContainer).removeClass(currentView.attr("rel")+" sqr-"+currentView.attr("rel")),currentView.removeClass("active").removeClass("sqr-active")),viewObject.addClass("active sqr-active"),$jQ("div.results, .sqr-results",this.resultContainer).addClass(viewObject.attr("rel")+" sqr-"+viewObject.attr("rel")),this.persistentParameters.viewType=viewObject.attr("rel"),$jQ(this.controllerInstance).trigger("viewTypeChanged",[viewObject.attr("rel")])},this.handleMoreResultsWindowScroll=function(event){if($jQ(this.controllerInstance.container).is(":hidden")||null==this.showMoreButton)return!1;if($jQ(this.resultContainer).find("div.sqr-out-of-view").hide(),this.lastResultParameters.resultsPanel.resultsInResponse+Math.max(0,this.lastResultParameters.resultsPanel.resultOffset)<this.lastResultParameters.resultsPanel.numberOfResults){var scrollTop=websight.util.getWindowScrollTop(),bottomOfPanel=Math.floor(this.resultContainer.height()+this.container.offset().top);scrollTop+$jQ(window).height()>=.8*bottomOfPanel&&this.lastScrollPosition!=scrollTop+$jQ(window).height()&&(this.lastScrollPosition=scrollTop+$jQ(window).height(),$jQ(window).off("scroll",this.moreResultsScrollHandler),this.loadMoreResults())}},this.moreResultsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMoreResultsWindowScroll,this),100):$jQ.proxy(this.handleMoreResultsWindowScroll,this),this.handleOptionBarWindowScroll=function(event){var sqrOptions=$jQ("div.sqr-options",this.resultContainer),scrollTop=websight.util.getWindowScrollTop(),isFixed=sqrOptions.hasClass("sqr-fixed"),sqrOptionsTop=sqrOptions.offset()?sqrOptions.offset().top:0,sqrOptionsOrigTop=sqrOptions.data("sqr-original-top");scrollTop>sqrOptionsTop+100&&!isFixed?(sqrOptions.data("sqr-original-top",sqrOptionsTop),sqrOptions.css({width:sqrOptions.outerWidth()+"px","z-index":this.controllerInstance.parameters.zIndex+1,"margin-left":-$jQ(window).scrollLeft()+"px"}).addClass("sqr-fixed")):scrollTop<=sqrOptionsOrigTop&&isFixed&&sqrOptions.css("width","").removeClass("sqr-fixed")},this.optionBarScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleOptionBarWindowScroll,this),100):$jQ.proxy(this.handleOptionBarWindowScroll,this),this.addClickEvents=function(objectsToTrack,parameters){if(null!=this.controllerInstance.addClickEvents)return $jQ.proxy(this.controllerInstance.addClickEvents,this.controllerInstance)(objectsToTrack,parameters);$jQ.each(objectsToTrack,$jQ.proxy(function(index,value){if(1==this.controllerInstance.indexSettings.view.enableResultitemClick){var url=$jQ("a",value).not(".custom-link").attr("href");$jQ(value).on("click",$jQ.proxy(function(event){var resultItem=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),resultId=resultItem.data("id"),titleLink=$jQ('a[rel="title"]',resultItem),resultTitle=titleLink.attr("title");if("enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),event.ctrlKey||event.metaKey){window.open(this.controllerInstance.searchCallback.createAnalyticsUrl(url),"_blank").focus().focus()}return this.trackClick(url,parameters.resultOffset+index+1,resultId,resultTitle,event),event.preventDefault(),event.stopPropagation(),!1},this))}$jQ("a",value).not(".custom-link").on("click",$jQ.proxy(function(event){var resultTitle,url=$jQ(event.currentTarget).attr("href"),resultItem=$jQ(event.currentTarget).closest(".resultItem, .sqr-resultItem"),titleLink=$jQ('a[rel="title"]',resultItem),resultId=resultItem.data("id");resultTitle=titleLink.attr("title")?titleLink.attr("title"):titleLink.text(),"enableBackButton"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableBackButton&&this.controllerInstance.searchCallback.saveBackButtonParameters(),(event.ctrlKey||event.metaKey)&&window.open(this.controllerInstance.searchCallback.createAnalyticsUrl(url),"_blank").focus(),this.trackClick(event.currentTarget.href,parameters.resultOffset+index+1,resultId,resultTitle,event),event.preventDefault(),event.stopPropagation()},this))},this))},this.changeSort=function(sortBy){this.persistentParameters.sortBy=sortBy,this.controllerInstance.searchCallback.directCallback({sortBy:this.persistentParameters.sortBy,filterInitiated:!0})},this.handleSortChange=function(val){this.changeSort(val)},this.handleSortClick=function(event){return this.changeSort($jQ(event.target).attr("rel")),event.preventDefault(),!1},this.updateResultsCounter=function(numberOfResults){$jQ("div.numberOfResults",this.container).html(numberOfResults+" resultaten")},this.toggleShowMoreButton=function(state){this.showMoreButton=$jQ("a.moreResults, a.sqr-moreResults",this.container),this.showMoreButton.length>0&&(this.showMoreButton.off("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.on("click",$jQ.proxy(this.loadMoreResults,this)),this.showMoreButton.css("display",state?"block":"none"))},this.toggleMoreResultsLoader=function(state){this.moreResultsLoader=$jQ("div.moreResultsLoader",this.container),this.moreResultsLoader.length>0&&this.moreResultsLoader.css("display",state?"block":"none")},this.trackClick=function(url,resultIndex,resultId,resultTitle,event){this.controllerInstance.searchCallback.tracker&&this.controllerInstance.tracking&&this.controllerInstance.searchCallback.tracker._trackResultClick(this.controllerInstance.getQueryText(),this.controllerInstance.searchCallback.requestId,this.controllerInstance.searchCallback.requestIndex,resultIndex,this.lastResultParameters.numberOfResults,resultId,resultTitle,url,event.ctrlKey||event.metaKey?null:$jQ.proxy(function(){$jQ(this.controllerInstance).trigger("click",[url,resultIndex,resultId,resultTitle])},this)),event.ctrlKey||event.metaKey||$jQ(this.controllerInstance).trigger("click",[url,resultIndex,resultId,resultTitle])},this.loadMoreResults=function(){return this.resultOffset+=this.lastResultParameters.resultsPanel.resultsInResponse,this.toggleShowMoreButton(!1),this.toggleMoreResultsLoader(!0),this.controllerInstance.searchCallback.directCallback({offset:this.resultOffset,filterInitiated:!0}),!1},this.updateResultNotifier=function(){var container=$jQ(this.resultContainer),offset=container.offset(),bottom=offset.top+container.height();if(bottom>0&&websight.util.getWindowScrollTop()>0&&bottom<websight.util.getWindowScrollTop()){container.css("position","relative");var text=this.lastResultParameters.resultsPanel.outOfViewText;if(0==$jQ("div.sqr-out-of-view",container).length){var controllerInstance=this.controllerInstance;container.append('<div class="sqr-out-of-view sooqrOutOfView"><span>'+text+"</span></div>"),$jQ("div.sqr-out-of-view",container).on("click",function(event){return $jQ("html, body").animate({scrollTop:0},"fast"),$jQ(this).closest("div.sqr-out-of-view").hide(),controllerInstance.updateMinimumHeight(),event.preventDefault(),!1})}else $jQ("div.sqr-out-of-view span",container).html(text);var outOfViewContainer=$jQ("div.sqr-out-of-view",container),outOfViewContainerTop=websight.util.getWindowScrollTop()-offset.top+(Math.floor($jQ(window).height()/2)-Math.floor(outOfViewContainer.height()/2));outOfViewContainer.css({"position":"absolute","left":Math.round(container.width()/2)-Math.floor(outOfViewContainer.width()/2)+"px","top":Math.floor(outOfViewContainerTop)+"px"})}else $jQ("div.sqr-out-of-view",container).hide(),container.css("position","none")},this.getContainerHeight=function(){return this.resultContainer?this.resultContainer.find(".sqr-results").height():0},this.toggleMoreResultsLoaderCallback=function(state){this.addResultsOnScroll&&(state?$jQ(window).off("scroll",this.moreResultsScrollHandler).on("scroll",this.moreResultsScrollHandler):$jQ(window).off("scroll",this.moreResultsScrollHandler))},this.translateWordsSetByJavascript=function(parameters){void 0!=parameters.translations&&($jQ("#sooqrSearchMobileTabsResultsText",this.container).html(void 0!=parameters.translations.results?parameters.translations.results:"Resultaten"),$jQ("#sooqrSearchMobileTabsFiltersText",this.container).html(void 0!=parameters.translations.filters?parameters.translations.filters:"Filteren"))},this.handleMobileBottomButtonsWindowScroll=function(event){var sqrMobileBottomButtons=$jQ(".sqr-mobile-bottom-button");if(!sqrMobileBottomButtons.length)return!1;var scrollTop=websight.util.getWindowScrollTop(),sqrMobileBottomButtonsTop=this.resultContainer.offset().top,sqrIsMobileBottomButtonsVisible=sqrMobileBottomButtons.is(":visible");scrollTop>sqrMobileBottomButtonsTop&&!sqrIsMobileBottomButtonsVisible?sqrMobileBottomButtons.fadeIn():scrollTop<=sqrMobileBottomButtonsTop&&sqrIsMobileBottomButtonsVisible&&sqrMobileBottomButtons.fadeOut()},this.mobileBottomButtonsScrollHandler="function"==typeof websight.util.debounce?websight.util.debounce($jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this),100):$jQ.proxy(this.handleMobileBottomButtonsWindowScroll,this)},websight.sooqr.SearchCallback=function(controllerInstance){this.delay=300,this.requestIndex=-1,this.requestId=null,this.scrollAfterRequest=null,this.timeoutHandle=null,this.inputField=null,this.controllerInstance=controllerInstance,this.filterPanel=null,this.resultsPanel=null,this.previousQueryParameters=null,this.queryParametersHistory=[],this.tracker=new websight.sooqr.Tracker(this.controllerInstance),this.tracker._setIndex(this.controllerInstance.parameters.index,this.controllerInstance.parameters.view),this.tracker._setAccount(this.controllerInstance.parameters.account),this.parameters=this.controllerInstance.getParameters(),this.delayedCallback=function(additionalParameters,inputField){this.clearTimeout(),void 0==additionalParameters&&(additionalParameters={}),this.controllerInstance.indexSettings.view.keypressDelay&&(this.delay=this.controllerInstance.indexSettings.view.keypressDelay),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters,inputField)},this),this.delay)},this.directCallback=function(additionalParameters){this.clearTimeout(),void 0==additionalParameters&&(additionalParameters={}),this.timeoutHandle=setTimeout($jQ.proxy(function(){this.callback(additionalParameters)},this),0)},this.clearTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},this.callback=function(queryParameters,inputField){this.clearTimeout(),this.queryParameters=queryParameters,void 0===inputField&&"queryField"in this.controllerInstance?this.inputField=this.controllerInstance.queryField:this.inputField=inputField;var searchQuery=this.controllerInstance.getSearchQuery(this.inputField);if((null==searchQuery||0==searchQuery.length)&&"Filter"!=this.controllerInstance.objectName){if(!("allowEmptyQuery"in this.controllerInstance.indexSettings.view&&0!=this.controllerInstance.indexSettings.view.allowEmptyQuery))return void this.controllerInstance.hideContainer();searchQuery=""}this.enableLoaderIcon();var filterQuery=null;if(this.filterPanel&&(void 0!=queryParameters.filterInitiated&&1==queryParameters.filterInitiated?filterQuery=this.filterPanel.toArray():queryParameters.filtersShowAll||this.filterPanel.clearLastFilterQuery()),queryParameters.filterInitiated||(filterQuery=this.controllerInstance.appendDefaultFilters(filterQuery)),filterQuery=this.controllerInstance.appendFixedFilters(filterQuery),this.filterPanel){filterParameters=this.filterPanel.persistentParameters;for(var k in filterParameters)queryParameters[k]=filterParameters[k]}if(filterQuery=this.controllerInstance.appendSecuredFilters(filterQuery),queryParameters=this.controllerInstance.appendSecuredFiltersParameters(queryParameters),queryParameters=this.controllerInstance.appendDynamicFieldsParameters(queryParameters),this.resultsPanel)for(var k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];this.sendSearchQuery(searchQuery,filterQuery,queryParameters)},this.sendSearchQuery=function(searchQuery,filterQuery,queryParameters){void 0==queryParameters.sortBy&&(queryParameters.sortBy=0),void 0==queryParameters.offset&&(queryParameters.offset=0),void 0==queryParameters.filterInitiated&&(queryParameters.filterInitiated=!1),void 0==queryParameters.triggerFilter&&(queryParameters.triggerFilter=null),void 0==queryParameters.filtersShowAll&&(queryParameters.filtersShowAll=!1),void 0==queryParameters.enableFiltersShowAll&&(queryParameters.enableFiltersShowAll=!1),void 0==queryParameters.filterValuesShowAll&&(queryParameters.filterValuesShowAll=null),void 0==queryParameters.securedFiltersHash&&(queryParameters.securedFiltersHash=!1),void 0==queryParameters.locale&&(queryParameters.locale=this.parameters.locale||websight.util.getLanguage()),null!=this.previousQueryParameters?null==searchQuery||searchQuery.match(new RegExp("^"+websight.util.regexpEscape(this.previousQueryParameters.searchQuery),"i"))||(this.requestId=websight.util.randomNumber(),this.requestIndex=-1):this.requestId=websight.util.randomNumber(),this.requestIndex++,this.previousQueryParameters=queryParameters,this.previousQueryParameters.searchQuery=searchQuery,this.previousQueryParameters.filterQuery=filterQuery,this.queryParametersHistory.push(this.previousQueryParameters),this.queryParametersHistory=this.queryParametersHistory.slice(-10),$jQ(this.controllerInstance).trigger("sendSearchQuery",[searchQuery,filterQuery,queryParameters]),"enableHash"in this.controllerInstance.indexSettings.view&&1==this.controllerInstance.indexSettings.view.enableHash&&this.serializeSearchToHash(),null!=this.controllerInstance.indexSettings.connection.proxy?this.sendSearchQueryByProxy(searchQuery,filterQuery,queryParameters):this.sendSearchQueryByScript(searchQuery,filterQuery,queryParameters)},this.saveBackButtonParameters=function(){var queryParameters=this.getQueryParameters(),data={"u":window.location.href,"q":queryParameters,"p":this.controllerInstance.getParameters()};data.p.scrollAfterRequest=websight.util.getWindowScrollTop();var newCookie="__sqrlq="+escape(JSON.stringify(data));newCookie+="; Path=/",newCookie+="; Domain=."+websight.util.removeWww(window.location.hostname),newCookie+="; Max-Age=300",document.cookie=newCookie},this.sendSearchQueryByProxy=function(searchQuery,filterQuery,queryParameters){$jQ.ajax(this.controllerInstance.indexSettings.connection.proxy,{async:!0,complete:this.sendSearchQueryByProxyCompleted,context:this,dataType:"json",data:this.buildSearchQuery(searchQuery,filterQuery,queryParameters),type:"POST"})},this.sendSearchQueryByScript=function(searchQuery,filterQuery,queryParameters){var dynamicScriptUrl=document.location.protocol+"//"+this.controllerInstance.indexSettings.connection.server+"/"+this.controllerInstance.getApiMethod()+"/script/?",queryData=this.buildSearchQuery(searchQuery,filterQuery,queryParameters);$jQ.getScript(dynamicScriptUrl+$jQ.param(queryData))},this.buildSearchQuery=function(searchQuery,filterQuery,queryParameters){var data={"type":this.controllerInstance.objectName.toLowerCase(),"searchQuery":searchQuery,"filterQuery":filterQuery,"filterInitiated":queryParameters.filterInitiated,"triggerFilter":queryParameters.triggerFilter,"filtersShowAll":queryParameters.filtersShowAll,"enableFiltersShowAll":queryParameters.enableFiltersShowAll,"filterValuesShowAll":queryParameters.filterValuesShowAll,"securedFiltersHash":queryParameters.securedFiltersHash,"sortBy":queryParameters.sortBy,"offset":queryParameters.offset,"limit":queryParameters.limit?queryParameters.limit:this.controllerInstance.indexSettings.view.resultsPerPage,"requestIndex":this.requestIndex,"locale":queryParameters.locale,"url":window.location.pathname};return this.controllerInstance.tracking&&(data.sid=[websight.util.domainHash(),this.tracker.getVisitorId(),this.tracker.initialVisit,this.tracker.previousSession,this.tracker.currentSession,this.tracker.sessionCount].join(".")),"viewType"in queryParameters&&(data.viewType=queryParameters.viewType),"dynamicFields"in queryParameters&&(data.dynamicFields=queryParameters.dynamicFields),this.parameters.index&&(data.index=this.parameters.index),this.parameters.view&&(data.view=this.parameters.view),this.parameters.account&&(data.account=this.parameters.account),data},this.sendSearchQueryByScriptCompleted=function(result){this.disableLoaderIcon(),this.processSearchQueryResult(result)},this.sendSearchQueryByProxyCompleted=function(httpObject,status){if(this.disableLoaderIcon(),0==httpObject.responseText.length)return void this.controllerInstance.hideContainer();try{var fullResult=$jQ.parseJSON(httpObject.responseText);result=fullResult.sooqr}catch(e){return websight.sooqr.Debug.log(e),!1}this.processSearchQueryResult(result,fullResult)},this.compareFilters=function(filters1,filters2){for(var id in filters1){var values=filters1[id];for(i in values)if(void 0!==filters2[id]&&-1===filters2[id].indexOf(values[i]))return!1}return!0},this.processSearchQueryResult=function(result,fullResult){var query=result.searchQuery,filters=[];for(var i in result.filtersPanel.filters){var filter=result.filtersPanel.filters[i];for(fI in filter.values){var value=filter.values[fI];!0===value.a&&(void 0===filters[filter.id]&&(filters[filter.id]=[]),filters[filter.id].push(value.l))}}for(var i=this.queryParametersHistory.length-1;i>=0;i--){var queryParameters=this.queryParametersHistory[i];if(this.compareFilters(filters,queryParameters.filterQuery)&&query==queryParameters.searchQuery){this.queryParametersHistory[i].numberOfResults=result.numberOfResults;break}}if(result.resultsPanel&&result.resultsPanel.enabled&&null==this.resultsPanel&&websight.sooqr.ResultsPanel&&(this.resultsPanel=new websight.sooqr.ResultsPanel(this.controllerInstance),this.resultsPanel.setPersistentParameters(this.previousQueryParameters)),!("requestIndex"in result&&parseInt(result.requestIndex)<this.requestIndex)){if("error"==result.status&&result.statusMessage)return websight.util.log(result.statusMessage),!1;this.controllerInstance.tracking&&(0==this.previousQueryParameters.filterInitiated?this.tracker._trackQuery(this.previousQueryParameters.searchQuery,result.numberOfResults,this.requestId,this.requestIndex):this.tracker._trackFilter(this.previousQueryParameters.searchQuery,result.numberOfResults,this.requestId,this.requestIndex));if(result.custom&&result.custom.enabled){$jQ(this.controllerInstance.container).children("div").not(".sooqrSearchOptionsMobile").hide(),this.controllerInstance.container.addClass("sqr-custom"),this.controllerInstance.container.append('<div class="sooqrCustom">'+result.custom.html+"</div>"),$jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","hidden");var queryParametersHistoryHasResults=!1;for(var i in this.queryParametersHistory)if(this.queryParametersHistory[i].numberOfResults>0){queryParametersHistoryHasResults=!0;break}return $jQ(".sqr-has-previous-query",this.controllerInstance.container).toggle(queryParametersHistoryHasResults),$jQ('a[rel="load-last-query"]',this.controllerInstance.container).toggle(queryParametersHistoryHasResults).on("click",$jQ.proxy(function(event){event.preventDefault(),this.reloadLastQuery()},this)),$jQ(".closeButton, .sqr-closeButton",this.controllerInstance.container).on("click",$jQ.proxy(function(event){this.controllerInstance.hideContainer()},this)),void this.controllerInstance.showContainer()}if($jQ("div.sooqrCustom").length){$jQ(".sooqrSearchMobileTabs",this.controllerInstance.container).css("visibility","visible"),$jQ("div.sooqrCustom",this.controllerInstance.container).remove(),this.controllerInstance.container.removeClass("sqr-custom").children("div").not(".sooqrSearchOptionsMobile").show();var $optionsMobile=$jQ(".sooqrSearchOptionsMobile",this.container),$filtersContainer=$jQ(".sooqrSearchFilters",this.container);$jQ(window).width()<this.controllerInstance.indexSettings.view.responsiveMobileWidth&&this.activeResponsiveWidth!=this.controllerInstance.indexSettings.view.responsiveMobileWidth&&$jQ(".sooqrSearchMobileTabsResults",$optionsMobile).hasClass("sooqrSearchMobileTabsActive")&&$filtersContainer.hide()}if(0==result.numberOfResults)return result.filtersPanel&&result.filtersPanel.enabled&&this.filterPanel&&(result.filterInitiated?this.filterPanel.updateFilters(result.filtersPanel,this.previousQueryParameters):this.filterPanel.togglePanel(!1)),result.resultsPanel&&result.resultsPanel.enabled&&this.resultsPanel&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer()),void $jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult]);if(result.resultsPanel.enabled&&this.resultsPanel&&!result.filtersPanel.enableFiltersShowAll&&(this.resultsPanel.updateResults(result),this.controllerInstance.showContainer(),$jQ(this.controllerInstance).trigger("updateResults",[fullResult])),result.filtersPanel.enabled){if(null==this.filterPanel)this.filterPanel=new websight.sooqr.FilterPanel(this.controllerInstance,result.filtersPanel,this.previousQueryParameters.filterQuery);else if(this.filterPanel.togglePanel(!0),result.filterInitiated)if(result.filtersPanel.enableFiltersShowAll)this.filterPanel.showHiddenFilters(result.filtersPanel);else{var previousQueryParameters=this.previousQueryParameters;$jQ.proxy(function(){this.updateFilters(result.filtersPanel,previousQueryParameters)},this.filterPanel)()}else $jQ.proxy(function(){this.initializePanel(result.filtersPanel)},this.filterPanel)();$jQ(this.controllerInstance).trigger("updateFilters",[fullResult])}if(result.experimentId?this.tracker.setExperimentId(result.experimentId):this.tracker.setExperimentId(null),this.controllerInstance.indexSettings.view.cssVersion>=4&&(this.controllerInstance.handleResponsiveResize(),this.resultsPanel.translateWordsSetByJavascript(result)),$jQ(".sqrSearchResultCounter",this.controllerInstance.container).text(result.numberOfResults),$jQ(".sqrSearchResultRemainingCounter",this.controllerInstance.container).text(result.resultsRemaining),null!=this.scrollAfterRequest&&($jQ(window).trigger("scroll"),websight.util.setWindowScrollTop(this.scrollAfterRequest),this.scrollAfterRequest=null,null!=this.resultsPanel)){$jQ("div.sqr-out-of-view",this.resultsPanel.container).hide()}$jQ(this.controllerInstance).trigger("queryResultProcessed",[fullResult])}},this.reloadLastQuery=function(){this.queryParametersHistory.pop();for(var queryParameters=this.queryParametersHistory.pop();this.queryParametersHistory.length>0&&(void 0==queryParameters.numberOfResults||0==queryParameters.numberOfResults);)queryParameters=this.queryParametersHistory.pop();if(0==this.queryParametersHistory.length)return!1;queryParameters.filterInitiated=!0,"triggerFilter"in this.previousQueryParameters&&"location"===this.filterPanel.getFilterType(this.previousQueryParameters.triggerFilter)&&this.filterPanel.clearGeoFilter(this.previousQueryParameters.triggerFilter),this.controllerInstance.setSearchQuery(queryParameters.searchQuery),this.sendSearchQuery(queryParameters.searchQuery,queryParameters.filterQuery,queryParameters)},this.enableLoaderIcon=function(){$jQ(this.controllerInstance).trigger("loading"),null==this.inputField||this.inputField.hasClass("sooqrQueryBoxLoading")||(this.inputField.addClass("_search_loading"),this.inputField.addClass("sooqrQueryBoxLoading"))},this.disableLoaderIcon=function(){null!=this.inputField&&this.inputField.hasClass("sooqrQueryBoxLoading")&&(this.inputField.removeClass("_search_loading"),this.inputField.removeClass("sooqrQueryBoxLoading")),$jQ(this.controllerInstance).trigger("completedLoading")},this.createAnalyticsUrl=function(url){var qparts={},needsReplace=!1;return this.controllerInstance.indexSettings.googleSearchTracking.enabled&&this.controllerInstance.indexSettings.googleSearchTracking.query_parameter&&(qparts[this.controllerInstance.indexSettings.googleSearchTracking.query_parameter]=encodeURIComponent(this.controllerInstance.getQueryText()),needsReplace=!0),this.controllerInstance.indexSettings.googleAdTracking.enabled&&(qparts.utm_source=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_source),qparts.utm_campaign=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_campaign),qparts.utm_medium=encodeURIComponent(this.controllerInstance.indexSettings.googleAdTracking.utm_medium),this.controllerInstance.indexSettings.googleAdTracking.utm_term&&(qparts.utm_term=encodeURIComponent(this.controllerInstance.getQueryText())),needsReplace=!0),needsReplace?websight.util.replaceQueryVars(url,qparts):url},this.getQueryParameters=function(){var queryParameters=this.previousQueryParameters;if(this.filterPanel)for(k in this.filterPanel.persistentParameters)queryParameters[k]=this.filterPanel.persistentParameters[k]
;if(this.resultsPanel)for(k in this.resultsPanel.persistentParameters)queryParameters[k]=this.resultsPanel.persistentParameters[k];return queryParameters},this.serializeSearchToHash=function(queryParameters){void 0===queryParameters&&(queryParameters=this.getQueryParameters());var hashValue="#",hash=decodeURIComponent(window.location.hash);hash&&(hashValue=null!==hash.match(/sqr:\(/)?hash.replace(/[\&]?sqr:\(.+\)/,""):hash,hashValue.length>1&&(hashValue+="&"));var queryInHash="";if("searchQuery"in queryParameters&&queryParameters.searchQuery.length&&(queryInHash+="q["+encodeURIComponent(queryParameters.searchQuery)+"]"),"filterQuery"in queryParameters){var fixedFilters=this.controllerInstance.getFixedFilters();for(var filterId in queryParameters.filterQuery)if(!fixedFilters.hasOwnProperty(filterId)){var values=[],type="f";if(void 0!==queryParameters.filterQuery[filterId].left&&void 0!==queryParameters.filterQuery[filterId].right){var value=queryParameters.filterQuery[filterId];queryInHash+=",slf"+filterId+"["+value.left+","+value.right+","+value.min+","+value.max+"]"}else{if(Array.isArray(queryParameters.filterQuery[filterId]))for(var p in queryParameters.filterQuery[filterId])queryParameters.filterQuery[filterId].hasOwnProperty(p)&&values.push(encodeURIComponent(queryParameters.filterQuery[filterId][p]));else type="sf",values.push(encodeURIComponent(queryParameters.filterQuery[filterId]));queryInHash+=","+type+filterId+"["+values.join(",")+"]"}}}if(queryInHash=queryInHash.replace(/^,/,""),queryInHash.length&&(hashValue+="sqr:("+queryInHash+")"),hashValue=hashValue.replace(/&$/,""),hashValue.length)if(window.history.replaceState)try{"#"===hashValue?window.history.replaceState("",document.title,window.location.pathname+window.location.search):window.history.replaceState(void 0,void 0,hashValue)}catch(e){window.location.replace((""+window.location).split("#")[0]+hashValue)}else window.location.replace((""+window.location).split("#")[0]+hashValue)},this.parseSearchFromHash=function(){var lastQuery={},hash=decodeURIComponent(window.location.hash),hasMatches=!1,match=!1,value="",filterId=null,re=/\[(.+?)\]/g,matchPart=!1,hashQuery=!1,partMatch=null;if(null!==(match=hash.match(/sqr:\((.+)\)/))){for(;matchPart=re.exec(match[1]);)match[1]=match[1].replace(matchPart[0],matchPart[0].replace(/,/g,";"));hashQuery=match[1].split(/,/),lastQuery={q:{filterInitiated:!1},filterQuery:this.controllerInstance.getFixedFilters()};for(var iIndex=0;iIndex<hashQuery.length;iIndex++)if(null!==(partMatch=hashQuery[iIndex].match(/^([a-z0-9]+)\[(.+)\]$/)))if(hasMatches=!0,"q"===partMatch[1])lastQuery.q.searchQuery=decodeURIComponent(partMatch[2]);else{filterId=null;var type="multi";if(-1!==partMatch[1].indexOf("sf")?(filterId=partMatch[1].replace(/^sf/,""),type="select"):-1!==partMatch[1].indexOf("slf")?(filterId=partMatch[1].replace(/^slf/,""),type="slider"):filterId=partMatch[1].replace(/^f/,""),"multi"===type){lastQuery.filterQuery[filterId]=partMatch[2].split(/;/);for(var p in lastQuery.filterQuery[filterId])if(p>=0){value="";try{value=decodeURIComponent(lastQuery.filterQuery[filterId][p])}catch(err){value=lastQuery.filterQuery[filterId][p]}lastQuery.filterQuery[filterId][p]=value}}else if("slider"===type){void 0===lastQuery.filterQuery[filterId]&&(lastQuery.filterQuery[filterId]={});var options=partMatch[2].split(/;/);for(var p in options){try{value=decodeURIComponent(options[p])}catch(err){value=options[p]}switch(parseInt(p)){case 0:lastQuery.filterQuery[filterId].left=value;break;case 1:lastQuery.filterQuery[filterId].right=value;break;case 2:lastQuery.filterQuery[filterId].min=value;break;case 3:lastQuery.filterQuery[filterId].max=value}}}else{value="";try{value=decodeURIComponent(partMatch[2])}catch(err){value=partMatch[2]}lastQuery.filterQuery[filterId]=value}}}return hasMatches&&(lastQuery.q=this.controllerInstance.appendDynamicFieldsParameters(lastQuery.q),lastQuery.q=this.controllerInstance.appendSecuredFiltersParameters(lastQuery.q),lastQuery.q=this.controllerInstance.appendDefaultFilters(lastQuery.q),lastQuery.q=this.controllerInstance.appendFixedFilters(lastQuery.q),this.controllerInstance.setSearchQuery(lastQuery.q.searchQuery),this.sendSearchQuery(lastQuery.q.searchQuery,lastQuery.filterQuery,lastQuery.q)),hasMatches}};
